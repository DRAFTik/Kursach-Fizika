on_actions = {
	on_startup = {
		effect = {
			#3ий сценарий
			if = {
				limit = {
					#has_start_date > 1941.12.01
					has_global_flag = THIRD_SCENARIO_FLAG
				}
				GER = { add_threat = -100 }
				#set_global_flag = AI_AGGRESSION_ULTRA_FLAG
				every_country = {
					limit = { NOT = { has_focus_tree = generic_focus } }
					load_focus_tree = { tree = generic_focus keep_completed = no }
				}
				every_country = {
					limit = { has_government = anarchism }
					country_event = { id = TRpolitical.106 }
				}
				every_country = {
					limit = { has_war_with = JAP }
					every_enemy_country = { white_peace = PREV }
				}
				every_country = {
					limit = { is_faction_leader = yes }
					dismantle_faction = yes
				}
				every_country = {
					limit = { is_subject = yes }
					drop_cosmetic_tag = yes
					OVERLORD = {
						set_autonomy = {
							target = PREV
							autonomy_state = autonomy_free
						}
					}
				}
				every_country = {
					division_template = {
						name = "National Guards"
						is_locked = no
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
							infantry = { x = 1 y = 3 }
							infantry = { x = 2 y = 0 }
							infantry = { x = 2 y = 1 }
							infantry = { x = 2 y = 2 }
						}
						priority = 1
					}
					add_ideas = {
						volunteer_only
						civilian_economy
						ai_aggression_ultra_idea
					}
					set_political_power = 0
					set_stability = 0.5
					set_war_support = 0.5
					set_research_slots = 4
					
					#Приколюхи, ага
					#set_technology = {
					#	atomic_research = 1
					#	nuclear_reactor = 1
					#	nukes = 1
					#}
					#add_nuclear_bombs = 100
				}
				random_country = {
					limit = { is_ai = no }
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): IS ADJUSTER"
					country_event = { id = NWgeneric.9999 }
				}
				set_variable = { global.total_trozkist = 0 }
				every_country = {
					limit = { has_government = trozkism }
					add_to_variable = { global.total_trozkist = 1 }
					if = {
						limit = {
							NOT = { has_dynamic_modifier = { modifier = troz_threat_dyn } }
						}
						add_dynamic_modifier = { modifier = troz_threat_dyn }
					}
					if = {
						limit = { NOT = { has_country_flag = is_trozkist_country_flag } }
						set_country_flag = is_trozkist_country_flag
					}
					if = {
						limit = { num_of_factories > 49 }
						add_to_variable = { global.troz_threat_var = 3 }
						log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 3 тронапряги как мажор"
					}
					else_if = {
						limit = { num_of_factories > 24 }
						add_to_variable = { global.troz_threat_var = 2 }
						log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 2 тронапряги как миддл"
					}
					else = {
						add_to_variable = { global.troz_threat_var = 1 }
						log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 1 тронапряги как минор)0"
					}
				}
				set_var_for_troz_threat_dyn = yes
			}
			random_country = {
				set_country_flag = timer_timer_flag
				log = "[GetDateText]: [This.GetName] ([This.GetTag]): Избран крикуном"
			}
			#Configurator
			#random_country = {
			#	limit = { is_ai = no }
			#	set_global_flag = nw_configurator_open
			#}
			
			if = {
				limit = { has_start_date < 1936.1.2 }
				random_country = { #1 мая the_gathering_storm
					country_event = { id = NWgeneric.15 days = 120 }
				}
			}
			else_if = {
				limit = {
					has_start_date > 1936.1.2
					has_start_date < 1939.8.15
				}
				random_country = { #1 мая blitzkrieg
					country_event = { id = NWgeneric.15 days = 261 }
				}
			}
			else_if = {
				limit = {
					has_start_date > 1939.8.15
				}
				random_country = { #1 мая 3 third scenario
					country_event = { id = NWgeneric.15 days = 147 }
				}
			}
			
			set_variable = { counter_days = 0 }
			
			#Delete SAI
			CHL = { transfer_state = 933 }
			933 = { remove_core_of = SAI }
			
			#Start legitimacy
			every_country = {
				country_event = { id = TRlegitimacy.8 }
				country_event = { id = tmo.migration.9 }
			}
			if = {
				limit = { is_historical_focus_on = no }
				every_country = {
					limit = {
						OR = {
							has_focus_tree = generic_focus
							has_focus_tree = generic_anarchism_focus
						}
						democratic < 1
						communism < 1
						fascism < 1
						neutrality < 1
						technocracy < 1
						trozkism < 1
						monarchy < 1
						anarchism < 1
					}
					random_list = {
						50 = { }
						20 = { add_popularity = { ideology = technocracy popularity = 0.2 } }
						10 = { add_popularity = { ideology = technocracy popularity = 0.15 } }
						10 = { add_popularity = { ideology = technocracy popularity = 0.1 } }
						10 = { add_popularity = { ideology = technocracy popularity = 0.05 } }
					}
				}
			}
			every_country = {
				limit = {
					OR = {
						tag = LIE
						tag = DNZ
						tag = ADR
						tag = MNC
						tag = TNR
						tag = GBT
					}
				}
				set_rule = { can_join_factions = no }
				set_rule = { can_create_factions = no }
				add_ideas = justify_minor_idea
				log = "[GetDateText]: [This.GetName] ([This.GetTag]): запрет вступать в альянсы"
			}
			
			if = {
				limit = {
					has_game_rule = {
						rule = trade_weapons
						option = DEFAULT
					}
				}
				random_country = {
					limit = { is_ai = no }
					set_variable = {
						var = global.total_infantry_weapons
						value = 0
					}
					set_variable = {
						var = global.total_artillery
						value = 0
					}
					set_variable = {
						var = global.total_support
						value = 0
					}
					set_variable = {
						var = global.total_motorized
						value = 0
					}
					set_variable = {
						var = global.total_mechanized
						value = 0
					}
					set_variable = {
						var = global.total_light_tanks
						value = 0
					}
					set_variable = {
						var = global.total_air_light_fighter
						value = 0
					}
					set_variable = {
						var = global.total_air_heavy_fighter
						value = 0
					}
				}
				random_country = {
					limit = { is_ai = yes }
					country_event = { id = TRpolitical.35 days = 365 random_days = 30 }
				}
			}
			
			# generic_tree_all_allowed
			if = {
				limit = {
					has_game_rule = {
						rule = generic_tree_all_allowed
						option = GENERIC_ALLOWED_ALL
					}
				}
				set_global_flag = generic_all_flag
			}
			
			# Wonder
			if = {
				limit = {
					OR = {
						has_game_rule = {
							rule = miracles_status
							option = MIRACLES
						}
						has_game_rule = {
							rule = miracles_status
							option = MIRACLES_AND_MOAI
						}
					}
				}
				random_country = {
					news_event = { id = trworldnews.35 days = 1 }
					news_event = { id = trworldnews.36 days = 1 }
				}
				2 = { set_state_flag = kolizeum_wonder_flag }
				616 = { set_state_flag = great_wall_wonder_flag }
				621 = { set_state_flag = great_wall_wonder_flag }
				611 = { set_state_flag = great_wall_wonder_flag }
				608 = { set_state_flag = great_wall_wonder_flag }
				609 = { set_state_flag = great_wall_wonder_flag }
				494 = { set_state_flag = machu_pikchu_wonder_flag }
				455 = { set_state_flag = petra_wonder_flag }
				437 = { set_state_flag = taj_mahal_wonder_flag }
				500 = { set_state_flag = cristos_redentor_wonder_flag }
				474 = { set_state_flag = chichen_itza_wonder_flag }
				341 = { set_state_flag = sobor_sofia_wonder_flag }
				1024 = { set_state_flag = afin_acropol_wonder_flag }
				173 = { set_state_flag = algambra_wonder_flag }
				741 = { set_state_flag = angkor_wonder_flag }
				933 = { set_state_flag = moai_wonder_flag }
				219 = { set_state_flag = kremlin_wonder_flag }
				52 = { set_state_flag = noishvanshtain_wonder_flag }
				552 = { set_state_flag = piramids_wonder_flag }
				358 = { set_state_flag = statuya_liberty_wonder_flag }
				338 = { set_state_flag = stonehenge_wonder_flag }
				556 = { set_state_flag = tombuktu_wonder_flag }
				531 = { set_state_flag = temple_kiemidzu_dera_wonder_flag }
				16 = { set_state_flag = eiffel_tower_wonder_flag }
				set_global_flag = wonder_yes
				#
				2 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = kolizeum_wonder } }
				616 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } }
				621 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } }
				611 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } }
				608 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } }
				609 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } }
				494 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = machu_pikchu_wonder } }
				455 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = petra_wonder } }
				437 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = taj_mahal_wonder } }
				500 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = cristos_redentor_wonder } }
				474 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = chichen_itza_wonder } }
				341 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = sobor_sofia_wonder } }
				1024 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = afin_acropol_wonder } }
				173 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = algambra_wonder } }
				741 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = angkor_wonder } }
				933 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } } } 	#no wonder
				219 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = kremlin_wonder } }
				52 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = noishvanshtain_wonder } }
				552 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = piramids_wonder } }
				358 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = statuya_liberty_wonder } }
				338 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = stonehenge_wonder } }
				556 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = tombuktu_wonder } }
				531 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = temple_kiemidzu_dera_wonder } }
				16 = { controller = { add_to_variable = { var = wonder_thief_score value = 1 } add_ideas = eiffel_tower_wonder } }
				every_country = {
					limit = { any_controlled_state = { has_state_flag = great_wall_wonder_flag } }
					country_event = { id = TR.wonder.29 }
				}
				#Start pointer great china wall
				every_country = {
					set_variable = {
						var = bonus_gw
						value = 0
					}
				}
				if = {
					limit = {
						has_game_rule = {
							rule = miracles_status
							option = MIRACLES_AND_MOAI
						}
					}
					set_global_flag = magic_moai
				}
			}
			
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				# Spain
				SPR = {
					country_event = { id = NWspain.2 days = 9 }
					country_event = { id = NWspain.3 days = 12 random_days = 2 }
					country_event = { id = NWspain.990 days = 15 } #Пульсар
					country_event = { id = NWspain.5 days = 44 }
				}
				
				# Poland
				POL = { country_event = { id = poland.flavor.2 days = 314 } }
				
				# Greece
				GRE = {
					country_event = { id = nw_greece.1 days = 26 }
					country_event = { id = nw_greece.14 days = 730 }
				}
			}
			set_variable = { var = var_add_pop value = 0 }
			
			if = {
				limit = {
					has_start_date > 1939.01.01
					has_start_date < 1940.01.01
				}
				POL = { country_event = { id = poland.flavor.2 days = 89 } }
			}
			#POL = { country_event = { id = poland.story.1 } }
			
			if = {
				limit = {
					OR = {
						has_game_rule = {
							rule = ai_aggression_status
							option = AI_AGGRESSION_ULTRA
						}
						has_global_flag = AI_AGGRESSION_ULTRA_FLAG
					}
				}
				every_country = {
					add_ideas = ai_aggression_ultra_idea
					set_rule = {
						can_declare_war_on_same_ideology = yes
						can_only_justify_war_on_threat_country = no
					}
				}
			}
			
			if = {
				limit = {
					has_game_rule = {
						rule = ai_faction_status
						option = AI_FACTION_NO
					}
				}
				every_country = {
					limit = { is_ai = yes }
					set_rule = { can_join_factions = no }
				}
			}
			#Цейлон стартпак
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				LKA = {
					country_event = { id = lka.11 days = 69 }
					country_event = { id = lka.12 days = 458 }
					country_event = { id = lka.13 days = 490 }
					country_event = { id = lka.14 days = 503 }
					country_event = { id = lka.33 days = 315 }
				}
			}
			#FRA Попытка фашистского государственного переворота
			if = {
				limit = { has_start_date < 1936.01.02 }
				FRA = { country_event = { id = NWfrance.51 months = 22 days = 16 hours = 13 } }
			}
			#Либерия стартпак
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				LIB = {
					country_event = { id = nw_liberia.100 days = 215 }
				}
				#Liberian oil
				if = {
					limit = {
						has_dlc = "Man the Guns"
					}
					LIB = {
						give_resource_rights = { receiver = USA state = 298 }
						give_resource_rights = { receiver = USA state = 1076 }
						give_resource_rights = { receiver = USA state = 1077 }
						give_resource_rights = { receiver = USA state = 1072 }
						give_resource_rights = { receiver = USA state = 1074 }
						give_resource_rights = { receiver = USA state = 1069 }
						give_resource_rights = { receiver = USA state = 1078 }
					}
				}
			}
			#Иран стартпак
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				PER = {
					country_event = { id = NWpersian.91 days = 7 }
					country_event = { id = NWpersian.153 days = 60 }
				}
			}
			#Ирак стартпак
			if = {
				limit = {
					has_dlc = "Man the Guns"
					has_start_date < 1936.01.02
				}
				IRQ = {
					give_resource_rights = { receiver = ENG state = 962 }
					give_resource_rights = { receiver = ENG state = 676 }
					country_event = { id = NWiraq.3 days = 299 }
					country_event = { id = NWiraq.13 days = 588 }
				}
			}
			#Палестина стартпак
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				BPL = {
					country_event = { id = NWpalestine.8 days = 792 }
					country_event = { id = NWpalestine.65 days = 229 }
				}
			}
			#Слоны стартовые стейты
			if = {
				every_state = {
					limit = {
						OR = {
							is_on_continent = africa
							is_core_of = RAJ
							is_core_of = NEP
							is_core_of = BHU
							is_core_of = SIA
							is_core_of = LKA
						}
					}
					set_state_flag = elephant_spawn_state_flag
				}
			}
			#Турок стартпак
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				if = {
					limit = {
						has_global_flag = NW_TUR_OLD_FOCUS_TREE 
					}
					TUR = {
						country_event = { id = NWturkey.10 days = 1044 }
					}
				}
				else = {
					TUR = {
						add_timed_idea = { idea = TUR_first_five_year_industrial_plan days = 1095 }
						add_ideas = {
							TUR_great_depression
							TUR_debts_to_great_powers
						}
						add_country_leader_trait = peace_in_country_world_peace
						add_country_leader_trait = modernization
						add_country_leader_trait = reformator
						add_country_leader_trait = seriously_ill
						country_event = { id = NW_new_turkey.56 days = 1044 }
					}
				}
				else = {
					TUR = { add_country_leader_trait = ataturk_trait }
				}
			}
			#Ньюф  стартпак
			NFL = {
				country_event = { id = Newfoundland.7 days = 3 }
			}
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				#смерть Элдердайса
				NFL = {
					country_event = { id = Newfoundland.72 days = 57 }
				}
				#вопрос о губернаторе
				ENG = {
					country_event = { id = Newfoundland.8 days = 218 }
				}
			}
		}
	}


	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			#check controller of great china wall
			if = {
				limit = {
					FROM.FROM = {
						has_state_flag = great_wall_wonder_flag
						is_controlled_by = ROOT
					}
				}
				ROOT = {
					add_to_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
				FROM = {
					subtract_from_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
			}
			
			#чечня - круто
			if = {
				limit = {
					FROM.FROM = { state = 966 }
					ROOT = { NOT = { original_tag = ICH } }
					FROM = {
						original_tag = ICH
						is_puppet = no
						is_subject = no
						NOT = { has_cosmetic_tag = ICH_Chechnya }
					}
				}
				FROM = { set_cosmetic_tag = ICH_Chechnya }
			}
			if = {
				limit = {
					FROM.FROM = { state = 966 }
					FROM = { NOT = { original_tag = ICH } }
					ROOT = {
						original_tag = ICH
						is_puppet = no
						is_subject = no
						has_cosmetic_tag = ICH_Chechnya
					}
				}
				ROOT = { drop_cosmetic_tag = yes }
			}
			
			#Небесные воины сошли на землю и обратили белых в бегство
			if = {
				limit = {
					ROOT = {
						tag = COG
						NOT = { has_country_flag = COG_no_state_flag }
					}
					FROM = { has_war_with = ROOT }
				}
				ROOT = {
					country_event = { id = cog.7 }
				}
			}
			
			#Разрушение дворца в Аддис-Абебе
			if = {
				limit = {
					FROM.FROM = { state = 271 }
					ROOT = {
						tag = ITA
						has_idea = ITA_gas_idea
					}
					FROM = {
						tag = ETH
						has_war_with = ROOT
					}
					NOT = { has_global_flag = ETH_destruction_of_palace }
				}
				FROM = { country_event = { id = NWethiopia.10 hours = 6 } }
			}
			
			#Снос чужого призывного пункта в стейте // генерик решения
			if = {
				limit = {
					FROM.FROM = { has_state_flag = has_recruiting_station_flag_@FROM }
				}
				FROM.FROM = {
					if = {
						limit = { check_variable = { recruiting_station_var_level > 0 } }
						if = {
							limit = { check_variable = { recruiting_station_var_level = 6 } }
							add_state_modifier = { modifier = { local_manpower = -1.0 } }
						}
						else_if = {
							limit = { check_variable = { recruiting_station_var_level = 5 } }
							add_state_modifier = { modifier = { local_manpower = -0.9 } }
						}
						else_if = {
							limit = { check_variable = { recruiting_station_var_level = 4 } }
							add_state_modifier = { modifier = { local_manpower = -0.8 } }
						}
						else_if = {
							limit = { check_variable = { recruiting_station_var_level = 3 } }
							add_state_modifier = { modifier = { local_manpower = -0.7 } }
						}
						else_if = {
							limit = { check_variable = { recruiting_station_var_level = 2 } }
							add_state_modifier = { modifier = { local_manpower = -0.6 } }
						}
						else_if = {
							limit = { check_variable = { recruiting_station_var_level = 1 } }
							add_state_modifier = { modifier = { local_manpower = -0.5 } }
						}
						clear_variable = recruiting_station_var_level
					}
					clr_state_flag = has_recruiting_station_flag_@FROM
				}
			}
		}
		#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	}
	
	on_government_change = {
		effect = {
			######### TROZKISM BLOCK #########
			if = {
				limit = { has_country_flag = is_trozkist_country_flag }
				clr_country_flag = is_trozkist_country_flag
				add_to_variable = { global.troz_threat_var = -1.5 }
				if = {
					limit = { has_cosmetic_tag = KMX_cosmetic }
					drop_cosmetic_tag = yes
				}
			}
			set_variable = { global.total_trozkist = 0 }
			every_country = {
				limit = { has_government = trozkism }
				add_to_variable = { global.total_trozkist = 1 }
				if = {
					limit = {
						NOT = { has_dynamic_modifier = { modifier = troz_threat_dyn } }
					}
					add_dynamic_modifier = { modifier = troz_threat_dyn }
				}
			}
			if = {
				limit = {
					has_government = trozkism
				}
				if = {
					limit = { NOT = { has_country_flag = is_trozkist_country_flag } }
					set_country_flag = is_trozkist_country_flag
				}
				if = {
					limit = { num_of_factories > 49 }
					add_to_variable = { global.troz_threat_var = 3 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 3 тронапряги как мажор"
				}
				else_if = {
					limit = { num_of_factories > 24 }
					add_to_variable = { global.troz_threat_var = 2 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 2 тронапряги как миддл"
				}
				else = {
					add_to_variable = { global.troz_threat_var = 1 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 1 тронапряги как минор)0"
				}
				set_var_for_troz_threat_dyn = yes
			}
			######### END TROZKISM BLOCK #########
			country_event = { id = TRpolitical.106 }
			#Габсы
			if = {
				limit = {
					NOT = { has_global_flag = THIRD_SCENARIO_FLAG }
					NOT = { has_country_flag = hhnbrg_flag }
					OR = {
						original_tag = CZE
						original_tag = AUS
						#AND = {
						#	original_tag = HUN	#Венгр и так монархист со старта
						#	HUN = { has_completed_focus = HUN_invite_the_habsburg_prince }
						#}
					}
					has_government = monarchy
				}
				if = {
					limit = { all_country = { NOT = { has_country_flag = hbbrg_flag } } }
					country_event = { id = NWmonarchy.0 }
				}
				if = {
					limit = { any_other_country = { has_country_flag = hbbrg_flag } }
					set_country_flag = hbbrg_minor_flag
					random_country = {
						limit = { has_country_flag = hbbrg_flag }
						if = {
							limit = { has_government = fascism }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_reichsprotectorate
							}
						}
						if = {
							limit = { NOT = { has_government = fascism } }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_puppet
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					tag = TUR
					has_government = fascism
					NOT = { has_country_flag = NWturkey70_flag }
				}
				TUR = {
					set_country_flag = NWturkey70_flag
					country_event = { id = NWturkey.69 days = 140 }
				}
			}
			
			if = {
				limit = {
					tag = USA
					has_government = trozkism
				}
				set_autonomy = {
					target = USA
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = {
						has_war_with = ROOT
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				if = {
					limit = {
						USA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					USA = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					USA = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					USA = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			if = {
				limit = {
					tag = CAN
					has_government = trozkism
				}
				set_autonomy = {
					target = CAN
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = {
						has_war_with = ROOT
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				if = {
					limit = {
						CAN = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					CAN = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					CAN = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					CAN = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			if = {
				limit = {
					tag = BRA
					has_government = trozkism
				}
				set_autonomy = {
					target = BRA
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = {
						has_war_with = ROOT
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				if = {
					limit = {
						BRA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					BRA = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					BRA = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					BRA = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			
			#ВБ стала троц и воюет с троц
			if = {
				limit = {
					tag = ENG
					has_government = trozkism
				}
				if = {
					limit = {
						ENG = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					ENG = { leave_faction = yes }
				}
				every_other_country = {
					limit = {
						has_war_with = ROOT
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					ENG = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					ENG = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = neutrality
					NOT = {
						has_country_flag = authoritarian_democracy
						has_country_flag = militarism
					}
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
						original_tag = TNG
						original_tag = NEA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
							original_tag = TNG
							original_tag = NEA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
			
			#Фокус «Умиротворение Германии» // Автовыполнение у event_target:NW_france_scope
			if = {
				limit = {
					tag = GER
					has_government = democratic
				}
				if = {
					limit = {
						country_exists = FRA
						FRA = { NOT = { has_completed_focus = FRA_appeasement_of_germany } }
					}
					FRA = { complete_national_focus = FRA_appeasement_of_germany }
				}
			}
			if = {
				limit = {
					tag = GRE
					NOT = { has_government = fascism }
				}
				if = {
					limit = { has_idea = GRE_antiparliamentarism }
					remove_ideas = GRE_antiparliamentarism
				}
				if = {
					limit = { has_idea = GRE_right_parliament }
					remove_ideas = GRE_right_parliament
				}
			}
			if = {
				limit = {
					original_tag = PER
					has_dynamic_modifier = { modifier = PER_influence_of_clergy_dynamic_modifier }
				}
				set_opinion_with_clergy_var = yes
				set_influence_clergy_Value = yes
			}
		}
	}
	
	
	#ROOT is subject FROM is previous overlord
	on_subject_free = {
		effect = {
			ROOT = { country_event = { id = TRpolitical.106 } }
			if = {
				limit = {
					tag = BPL
					has_cosmetic_tag = BPL_UK
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = PAL
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = JOR
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LEB
					FROM = {
						OR = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = SYR
					FROM = {
						OR = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LKA
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = NFL
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = POL
					FROM = { original_tag = SOV }
				}
				POL = { drop_cosmetic_tag = yes }
			}
			if = {
				limit = {
					tag = COG
					FROM = { original_tag = BEL }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = PER
					FROM = { original_tag = ENG }
				}
				every_country = {
					limit = { has_country_flag = PER_integration_south_azerbaijan_flag }
					clr_country_flag = PER_integration_south_azerbaijan_flag
				}
				if = {
					limit = {
						country_exists = QAS
						ROOT = { NOT = { has_war_with = QAS } }
						NOT = { has_country_flag = NWpersian_74_flag }
					}
					country_event = { id = NWpersian.74 hours = 6 }
				}
			}
		}
	}
	
	
	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			######### TROZKISM BLOCK #########
			if = {
				limit = { has_country_flag = is_trozkist_country_flag }
				clr_country_flag = is_trozkist_country_flag
				add_to_variable = { global.troz_threat_var = -1.5 }
			}
			set_variable = { global.total_trozkist = 0 }
			every_country = {
				limit = { has_government = trozkism }
				add_to_variable = { global.total_trozkist = 1 }
				if = {
					limit = {
						NOT = { has_dynamic_modifier = { modifier = troz_threat_dyn } }
					}
					add_dynamic_modifier = { modifier = troz_threat_dyn }
				}
			}
			if = {
				limit = {
					ROOT = { has_government = trozkism }
				}
				if = {
					limit = { NOT = { has_country_flag = is_trozkist_country_flag } }
					set_country_flag = is_trozkist_country_flag
				}
				if = {
					limit = { num_of_factories > 49 }
					add_to_variable = { global.troz_threat_var = 3 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 3 тронапряги как марионетка"
				}
				else_if = {
					limit = { num_of_factories > 24 }
					add_to_variable = { global.troz_threat_var = 2 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 2 тронапряги как марионетка"
				}
				else = {
					add_to_variable = { global.troz_threat_var = 1 }
					log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 1 тронапряги как марионетка"
				}
				set_var_for_troz_threat_dyn = yes
			}
			######### END TROZKISM BLOCK #########
			ROOT = { country_event = { id = TRpolitical.106 } }
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = trozkism
					NOT = { tag = TUR }
				}
				random_list = {
					50 = { set_country_leader_ideology = marxism1 }
					50 = { set_country_leader_ideology = trozkism1 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					NOT = { has_country_flag = authoritarian_democracy }
					NOT = { has_country_flag = militarism }
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
						original_tag = TNG
						original_tag = NEA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
							original_tag = TNG
							original_tag = NEA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
			#Определение победителя // Конец ГВ либералов
			if = {
				limit = {
					OR = {
						has_global_flag = liberal_spanish_civil_war
						has_global_flag = haos_liberal_spanish_civil_war
					}
					NOT = { has_global_flag = scw_over }
					ROOT = {
						OR = {
							tag = SPR
							tag = CAS
							tag = NAV
							tag = SEU
							tag = SPC
							tag = ANL
							tag = ARA
							tag = ASU
							tag = SNT
							tag = CAT
							tag = BAS
							tag = GLC
							tag = VLA
						}
					}
					FROM = {
						OR = {
							tag = SPR
							tag = CAS
							tag = NAV
							tag = SEU
							tag = SPC
							tag = ANL
							tag = ARA
							tag = ASU
							tag = SNT
							tag = CAT
							tag = BAS
							tag = GLC
							tag = VLA
						}
					}
				}
				ROOT = { country_event = { id = NWspain.50 hours = 6 } }
			}
			if = {
				limit = {
					tag = SYR
					has_cosmetic_tag = SYR_FRA
					FROM = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LEB
					has_cosmetic_tag = LEB_FR
					FROM = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LKA
					has_cosmetic_tag = LKA_ENG
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = NFL
					has_cosmetic_tag = NFL_ENG
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
		}
		#ROOT = nation being puppeted, FROM = overlord
	}
	
	
	
	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	
	on_release_as_puppet = {
		effect = {
			ROOT = { country_event = { id = TRpolitical.106 } }
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = trozkism
					NOT = { tag = TUR }
				}
				random_list = {
					50 = { set_country_leader_ideology = marxism1 }
					50 = { set_country_leader_ideology = trozkism1 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					NOT = { has_country_flag = authoritarian_democracy }
					NOT = { has_country_flag = militarism }
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
						original_tag = TNG
						original_tag = NEA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
							original_tag = TNG
							original_tag = NEA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
			if = {
				limit = {
					tag = COG
					NOT = {
						FROM = {
							original_tag = BEL
						}
					}
				}
				COG = {
					drop_cosmetic_tag = yes
				}
			}
		}
	}
	
	#FROM is war target
	on_declare_war = {
		effect = {
			#YUG agr
			if = {
				limit = {
					ROOT = { tag = YUG }
					YUG = { has_country_flag = no_barter_flag }
					FROM = { has_country_flag = anti_YUG_flag }
				}
				FROM = {
					every_other_country = {
						limit = {
							has_country_flag = anti_YUG_flag
							NOT = { tag = FROM }
						}
						country_event = { id = NWmonarchy.97 days = 1 }
					}
				}
			}
			#YUG def
			if = {
				limit = {
					FROM = { tag = YUG }
					YUG = { has_country_flag = no_barter_flag }
					ROOT = { has_country_flag = anti_YUG_flag }
				}
				ROOT = {
					every_other_country = {
						limit = {
							has_country_flag = anti_YUG_flag
							NOT = { tag = ROOT }
						}
						country_event = { id = NWmonarchy.97 days = 1 }
					}
				}
			}
			#ARA states and troops
			if = {
				limit = {
					OR = {
						AND = {
							FROM = { tag = SPR }
							ROOT = { tag = ARA }
						}
						AND = {
							FROM = { tag = ARA }
							ROOT = { tag = SPR }
						}
					}
					ARA = { has_country_flag = ARA_call_to_anarchists_andalusia_flag }
				}
				ARA = {
					transfer_state = 169
					transfer_state = 173
					division_template = {
						name = "Anarchists Brigada N2"
						priority = 1
						is_locked = no
						regiments = {
							infantry = { x = 0 y = 0 }
							infantry = { x = 0 y = 1 }
							infantry = { x = 0 y = 2 }
							infantry = { x = 1 y = 0 }
							infantry = { x = 1 y = 1 }
							infantry = { x = 1 y = 2 }
						}
					}
					169 = {
						create_unit = {
							division = "name = \"1. Anarchists Brigada\" division_template = \"Anarchists Brigada N2\" start_experience_factor = 0.5" 
							owner = ARA
						}
					}
					173 = {
						create_unit = {
							division = "name = \"2. Anarchists Brigada\" division_template = \"Anarchists Brigada N2\" start_experience_factor = 0.5" 
							owner = ARA
						}
					}
					clr_country_flag = ARA_call_to_anarchists_andalusia_flag
				}
			}
			
			#Анархо-Испанская ГВ (1vs1vs1)
			#if = {
			#	limit = {
			#		FROM = { tag = SPR }
			#		ROOT = { tag = ARA }
			#		has_global_flag = spanish_civil_war
			#		NOT = { has_global_flag = scw_over }
			#		SPR = { has_war_with = SPA }
			#	}
			#	ROOT = {
			#		news_event = { id = trworldnews.68 hours = 6 }
			#	}
			#}
			
			# Потеря Грецией нацдуха в случае британской агрессии
			if = { 
				limit = { 
					ROOT = { original_tag = ENG } 
					FROM = { original_tag = GRE }
					GRE = { has_idea = GRE_idea_pro_british_king }
				} 
				GRE = { 
					swap_ideas = {
						remove_idea = GRE_idea_pro_british_king
						add_idea = GRE_idea_georg_ii
					}
				}
			}
			#Сброс нац. духов ТроФранка
			if = {
				limit = {
					FROM = {
						OR = {
							tag = ITA
							tag = ENG
							tag = SPR
							tag = SIA
							tag = INS
							tag = RAJ
						}
						has_idea = trozkism_influence6
					}
					ROOT = {
						tag = event_target:NW_france_scope
						has_government = trozkism
					}
				}
				FROM = {
					remove_ideas = trozkism_influence6
				}
			}
			
			#FRA // Фокус "Укрепление Сопротивления в Северной Франции"
			if = {
				limit = {
					OR = {
						AND = {
							FROM = {
								OR = {
									tag = ITA
									tag = GER
								}
							}
							ROOT = {
								tag = FRA
								has_country_flag = FRA_strengthening_resistance_in_northern_france_flag
							}
						}
						AND = {
							FROM = {
								tag = FRA
								has_country_flag = FRA_strengthening_resistance_in_northern_france_flag
							}
							ROOT = {
								OR = {
									tag = ITA
									tag = GER
								}
							}
						}
					}
				}
				FRA = {
					clr_country_flag = FRA_strengthening_resistance_in_northern_france_flag
				}
				every_state = {
					limit = {
						is_core_of = FRA
						controller = {
							OR = {
								tag = ITA
								tag = GER
								is_in_faction_with = ITA
								is_in_faction_with = GER
								is_subject_of = GER
								is_subject_of = ITA
							}
						}
					}
					FRA = { transfer_state = PREV }
				}
			}
			#Франко ГВ
			if = {
				limit = {
					FROM = {
						OR = {
							tag = FRA
							tag = FRC
							tag = FRF
							tag = FRR
						}
					}
					ROOT = {
						OR = {
							tag = FRA
							tag = FRC
							tag = FRF
							tag = FRR
						}
					}
				}
				FROM = { add_ideas = FRA_civil_war }
				ROOT = { add_ideas = FRA_civil_war }
			}
			#Польша на два фронта
			if = {
				limit = {
					has_global_flag = sov_yes_pact
					NOT = { GER = { is_in_faction_with = SOV } }
					POL = {
						is_in_faction = yes
						is_faction_leader = no
					}
					OR = {
						POL = { has_war_with = GER }
						POL = { has_war_with = SOV }
					}
					OR = {
						AND = {
							FROM = { OR = { tag = SOV tag = GER } }
							ROOT = { tag = POL }
						}
						AND = {
							FROM = { tag = POL }
							ROOT = { OR = { tag = SOV tag = GER } }
						}
					}
				}
				FROM = { set_country_flag = POL_truce }
				ROOT = { set_country_flag = POL_truce }
				
				random_country = {
					limit = {
						is_in_faction_with = POL
						is_faction_leader = yes
					}
					if = {
						limit = { NOT = { has_war_with = FROM has_war_with = ROOT } }
						country_event = { id = poland.war.42 }
					}
					else = {
						FROM = { clr_country_flag = POL_truce }
						ROOT = { clr_country_flag = POL_truce }
					}
				}
			}
			#Привлечение германских советников // PER
			if = {
				limit = {
					PER = {
						has_completed_focus = PER_involvement_german_advisers
						NOT = { has_country_flag = PER_involvement_german_advisers_once_flag }
					}
					OR = {
						AND = {
							FROM = { tag = GER }
							ROOT = { tag = PER }
						}
						AND = {
							FROM = { tag = PER }
							ROOT = { tag = GER }
						}
					}
				}
				PER = {
					set_country_flag = PER_involvement_german_advisers_once_flag
					every_owned_state = {
						remove_building = {
							type = infrastructure
							level = 1
						}
					}
				}
			}
			#Цейлон риск голода
			if = {
				limit = {
					OR = {
						ROOT = { tag = LKA }
						FROM = { tag = LKA }
					}
					LKA = { has_idea = LKA_idea_food_risk }
				}
				LKA = { country_event = { id = lka.46 days = 60 } }
			}
			#Последствия советско-персидского договора
			if = {
				limit = {
					FROM = {
						OR = {
							tag = SOV
							tag = PER
						}
					}
					ROOT = {
						OR = {
							tag = SOV
							tag = PER
						}
					}
					PER = { has_idea = PER_soviet_persian_treaty }
				}
				PER = {
					remove_ideas = PER_soviet_persian_treaty
					add_timed_idea = { idea = PER_soviet_persian_treaty_2 days = 180 }
				}
			}
			#Отсчет Белого мира для Американо-либерийской
			if = {
				limit = {
					FROM = {
						OR = {
							tag = LIB
							tag = USA
						}
					}
					ROOT = {
						OR = {
							tag = LIB
							tag = USA
						}
					}
					USA = { has_country_flag = nw_liberia_27a_flag }
				}
				LIB = {
					set_country_flag = { flag = LIB_usa_white_peace_flag days = 120 }
				}
			}
			#Разрыв экономических связей // AFG
			if = {
				limit = {
					AFG = {
						has_idea = AFG_addiction_foreign_trade
						NOT = { has_idea = AFG_failed_trade_system }
					}
					OR = {
						FROM = {
							tag = AFG
						}
						ROOT = {
							OR = {
								tag = SOV
								if = {
									limit = {
										NOT = { country_exists = RAJ }
										439 = { is_controlled_by = ENG }
									}
									tag = ENG
								}
								else = { tag = RAJ }
							}
						}
					}
					OR = {
						FROM = {
							OR = {
								tag = SOV
								if = {
									limit = {
										NOT = { country_exists = RAJ }
										439 = { is_controlled_by = ENG }
									}
									tag = ENG
								}
								else = { tag = RAJ }
							}
						}
						ROOT = {
							tag = AFG
						}
					}
				}
				AFG = { country_event = { id = afg.4 days = 1 } }
			}
			FROM = {
				set_country_flag = is_war_target_of_@ROOT
				log = "[GetDateText]: [This.GetName] ([This.GetTag]): is war target of [Root.GetName] ([Root.GetTag])"
			}
			#Страна в гражданской войне
			if = {
				limit = {
					if = {
						limit = { SPR_scw_in_progress = yes }
						FROM = { is_literally_spain = no }
						ROOT = { is_literally_spain = no }
					}
					FROM = {
						has_civil_war = yes
						NOT = { has_idea = generic_civil_war }
					}
					ROOT = {
						has_civil_war = yes
						NOT = { has_idea = generic_civil_war }
					}
				}
				FROM = { add_ideas = generic_civil_war }
				ROOT = { add_ideas = generic_civil_war }
			}
			#Страна в гражданской войне
			if = {
				limit = {
					FROM = {
						OR = {
							tag = SOV
							tag = PER
						}
					}
					ROOT = {
						OR = {
							tag = SOV
							tag = PER
						}
					}
					PER = {
						OR = {
							has_country_flag = PER_organize_an_uprising_in_tajikistan_complete_flag
							has_country_flag = PER_organize_an_uprising_in_azerbaijan_complete_flag
						}
					}
				}
				if = {
					limit = { PER = { has_country_flag = PER_organize_an_uprising_in_tajikistan_complete_flag } }
					PER = {
						clr_country_flag = PER_organize_an_uprising_in_tajikistan_complete_flag
						load_oob = "PER_soviet_rise_taj"
					}
				}
				if = {
					limit = { PER = { has_country_flag = PER_organize_an_uprising_in_azerbaijan_complete_flag } }
					PER = {
						clr_country_flag = PER_organize_an_uprising_in_azerbaijan_complete_flag
						load_oob = "PER_soviet_rise_azr"
					}
				}
			}
			### TRO THREAT ###
			if = {
				limit = {
					OR = {
						AND = {
							ROOT = { has_government = trozkism }
							FROM = { NOT = { has_government = trozkism } }
						}
						AND = {
							FROM = { has_government = trozkism }
							ROOT = { NOT = { has_government = trozkism } }
						}
					}
				}
				add_to_variable = { global.troz_threat_var = 1 }
				custom_effect_tooltip = troz_threat_tt1
				set_var_for_troz_threat_dyn = yes
				log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил 1 тронапряги из-за нападения на [From.GetName] ([From.GetTag])"
			}
			if = {
				limit = {
					ROOT = { has_government = trozkism }
					FROM = { has_government = trozkism }
				}
				add_to_variable = { global.troz_threat_var = -5 }
				custom_effect_tooltip = troz_threat_tt2
				set_var_for_troz_threat_dyn = yes
				log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил -5 тронапряги из-за нападения на [From.GetName] ([From.GetTag])"
			}
		} #FROM is war target
	}
	
	# ROOT is capitulated country, FROM is winner
	on_capitulation = {
		effect = {
			#End of SCW
			#Классическая ГВ Испании
			if = {
				limit = {
					FROM = {
						tag = SPA
					}
					ROOT = {
						tag = SPR
					}
				}
				#FROM = { add_timed_idea = { idea = SPA_recovering_from_civil_war days = 1825 } }
				
				FROM = {
					if = {
						limit = {
							ARA = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = ARA
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							BAS = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = BAS
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							CAT = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = CAT
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							GLC = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = GLC
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							ASU = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = ASU
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							SNT = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = SNT
								transfer_troops = no
							}
						}
					}
					if = {
						limit = {
							VLA = {
								has_war_with = SPA
								is_puppet_of = SPR
							}
						}
						FROM = {
							annex_country = {
								target = VLA
								transfer_troops = no
							}
						}
					}
					
					
					every_state = {
						limit = { is_core_of = SPR }
						remove_core_of = SPR
					}
					
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					FROM = {
						OR = {
							tag = SPR
							tag = SPA
						}
					}
					ROOT = {
						OR = {
							tag = SPR
							tag = SPA
						}
					}
				}
				FROM = {
					add_timed_idea = { idea = SPA_recovering_from_civil_war days = 1825 }
					every_state = {
						limit = { is_core_of = ROOT }
						remove_core_of = ROOT
					}
					
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			
			if = {
				limit = {
					ROOT = { tag = ASU }
				}
				ROOT = {
					174 = { remove_core_of = ASU }
					drop_cosmetic_tag = yes
				}
			}
			if = {
				limit = {
					ROOT = { tag = SNT }
				}
				ROOT = {
					drop_cosmetic_tag = yes
				}
			}
			
			#Святое войско уничтожило источник Сатаны на земле белых
			if = {
				limit = {
					FROM = {
						tag = COG
						NOT = { has_country_flag = COG_no_capitulation_flag }
					}
				}
				FROM = {
					country_event = { id = cog.9 }
				}
			}
			
			#Образование Эллинского государства
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = GRE
							tag = CRE
						}
					}
					GER = { has_war_with = ROOT }
					has_global_flag = ger_form_hel_flag
					NOT = { has_global_flag = ger_form_hel_end_flag }
				}
				GER = { country_event = { id = NWgreece_hel.1 days = 1 } }
			}
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = GRE
							tag = CRE
						}
					}
					GER = {
						has_war_with = ROOT
						has_government = fascism
					}
					ITA = {
						has_government = fascism
						is_in_faction_with = GER
					}
					NOT = { has_global_flag = ger_form_hel_flag }
					NOT = { has_global_flag = ger_form_hel_end_flag }
				}
				random_country = {
					limit = {
						NOT = { tag = ROOT }
						has_war_with = ROOT
					}
					country_event = { id = NWgreece_hel.999 }
				}
			}
			
			#Падение марионеточной Греции
			if = {
				limit = {
					ROOT = { tag = HEL }
					FROM = {
						OR = {
							OR = {
								tag = GRE
								is_in_faction_with = GRE
							}
							OR = {
								tag = CRE
								is_in_faction_with = CRE
							}
						}
					}
					NOT = { has_global_flag = ger_form_hel_flag }
					NOT = { has_global_flag = ger_form_hel_end_flag }
				}
				FROM = { country_event = { id = NWgreece_hel.7 days = 1 } }
			}
			
			#Сопротивление Греции
			if = {
				limit = {
					ROOT = {
						OR = {
							tag = GRE
							AND = {
								tag = CRE
								NOT = {
									has_government = communism
									has_government = trozkism
								}
							}
						}
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = {
								tag = HEL
								has_idea = HEL_illegitimate_government
							}
						}
					}
					FROM = {
						set_variable = { resistance_score = 48 }
						country_event = { id = NWgreece_hel.8 days = 1 }
					}
				}
			}
			
			#ГВ Габс/Гогены
			if = {
				limit = {
					has_civil_war = no
					OR = {
						AND = {
							ROOT = { tag = event_target:NW_hbbrg_scope }
							FROM = { tag = event_target:NW_hhnbrg_scope }
						}
						AND = {
							ROOT = { tag = event_target:NW_hhnbrg_scope }
							FROM = { tag = event_target:NW_hbbrg_scope }
						}
					}
				}
				FROM = {
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
				every_state = {
					limit = { is_core_of = ROOT }
					add_core_of = FROM
				}
			}
			
			#ГВ IRQ
			if = {
				limit = {
					IRQ = { has_civil_war = yes }
					ROOT = {
						original_tag = IRQ
						NOT = { has_government = communism }
						is_subject_of = ENG
					}
				}
				ENG = { country_event = { id = NWiraq.8 } }
			}
			
			#ЖОР BPL = PAL/ISR
			if = {
				limit = {
					ROOT = {
						OR = {
							original_tag = PAL
							original_tag = ISR
						}
					}
					OR = {
						BPL = { is_subject_of = FROM }
						FROM = {
							OR = {
								original_tag = BPL
								is_in_faction_with = BPL
								is_subject_of = BPL
							}
						}
					}
				}
				BPL = {
					annex_country = {
						target = ROOT
						transfer_troops = yes
					}
				}
				every_state = {
					limit = { is_core_of = ROOT }
					add_core_of = BPL
					remove_core_of = ROOT
				}
			}
			### TRO THREAT ###
			if = {
				limit = { ROOT = { has_government = trozkism } }
				add_to_variable = { global.troz_threat_var = -1 }
				set_var_for_troz_threat_dyn = yes
				log = "[GetDateText]: [Root.GetName] ([Root.GetTag]): добавил -1 тронапряги капитуляцией"
			}
			# ROOT is capitulated country, FROM is winner
		}
	}
	
	on_uncapitulation = {
		effect = {
			# Уборка фабрик и доков вне карты после возвращения домой
			if = {
				limit = {
					original_tag = ROOT
					check_variable = { var = industrialists_counter@ROOT value > 0 }
				}
				set_variable = { var_null@ROOT = 0 }
				subtract_from_variable = { var_null@ROOT = industrialists_counter@ROOT }
				add_offsite_building = { type = arms_factory level = var_null@ROOT }
				add_offsite_building = { type = industrial_complex level = var_null@ROOT }
				set_variable = { industrialists_counter@ROOT = 0 }
			}
			if = {
				limit = {
					original_tag = ROOT
					check_variable = { var = obtain_dockyard_counter@ROOT value > 0 }
				}
				set_variable = { var_null@ROOT = 0 }
				multiply_variable = { industrialists_counter@ROOT = 2 }				
				subtract_from_variable = { var_null@ROOT = obtain_dockyard_counter@ROOT }
				add_offsite_building = { type = dockyard level = var_null@ROOT }
				set_variable = { obtain_dockyard_counter@ROOT = 0 }
			}
		}
	}
	
	#ROOT is winner #FROM gets annexed - For civil wars on_civil_war_end is also fired
	on_annex = {
		effect = {
			#SPR - ARA
			if = {
				limit = {
					FROM = { tag = SPR }
					ROOT = {
						OR = {
							tag = ARA
							tag = CAT
						}
					}
				}
				ARA = {
					every_state = {
						limit = {
							is_claimed_by = ARA
							NOT = { is_fully_controlled_by = ARA }
						}
						remove_core_of = ARA
						remove_claim_by = ARA
					}
				}
				if = {
					limit = { GLC = { exists = yes } }
					ARA = {
						every_state = {
							limit = { is_fully_controlled_by = GLC }
							add_claim_by = ARA
							add_core_of = ARA
						}
					}
				}
				if = {
					limit = { BAS = { exists = yes } }
					ARA = {
						every_state = {
							limit = { is_fully_controlled_by = BAS }
							add_claim_by = ARA
							add_core_of = ARA
						}
					}
				}
				if = {
					limit = { ASU = { exists = yes } }
					ARA = {
						every_state = {
							limit = { is_fully_controlled_by = ASU }
							add_claim_by = ARA
							add_core_of = ARA
						}
					}
				}
				if = {
					limit = { SNT = { exists = yes } }
					ARA = {
						every_state = {
							limit = { is_fully_controlled_by = SNT }
							add_claim_by = ARA
							add_core_of = ARA
						}
					}
				}
				if = {
					limit = { CAT = { exists = yes } }
					CAT = {
						every_state = {
							limit = {
								is_claimed_by = CAT
								NOT = { is_fully_controlled_by = CAT }
							}
							remove_core_of = CAT
							remove_claim_by = CAT
						}
					}
				}
				SPR = {
					every_state = {
						limit = {
							is_core_of = SPR
						}
						remove_core_of = SPR
						remove_claim_by = SPR
					}
				}
			}
			
			
			#Пульсар побед лагерей // правые
			if = {
				limit = {
					has_global_flag = liberal_spanish_civil_war
					NOT = { has_global_flag = scw_over }
					FROM = {
						OR = {
							tag = SPC
							tag = ANL
							tag = ARA
						}
					}
				}
				ROOT = { country_event = { id = NWspain.51 hours = 6 } }
			}
			
			#Пульсар побед лагерей // левые
			if = {
				limit = {
					has_global_flag = liberal_spanish_civil_war
					NOT = { has_global_flag = scw_over }
					FROM = {
						OR = {
							tag = CAS
							tag = NAV
							tag = SEU
						}
					}
				}
				ROOT = { country_event = { id = NWspain.52 hours = 6 } }
			}
			
			#Снятие клеймов и корок у проигравшего минора Испании
			if = {
				limit = {
					OR = {
						has_global_flag = liberal_spanish_civil_war
						has_global_flag = haos_liberal_spanish_civil_war
					}
					NOT = { has_global_flag = scw_over }
					FROM = {
						OR = {
							tag = SPR
							tag = CAS
							tag = NAV
							tag = SEU
							tag = SPC
							tag = ANL
							tag = ARA
							tag = ASU
							tag = SNT
							tag = CAT
							tag = BAS
							tag = GLC
							tag = VLA
						}
					}
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
			}
			
			#Жор каталонии-марионетки // Либеральная ГВ
			if = {
				limit = {
					has_global_flag = liberal_spanish_civil_war
					NOT = { has_global_flag = scw_over }
					FROM = { tag = SPR }
				}
				if = {
					limit = {
						country_exists = CAT
						CAT = {
							is_ai = yes
							OR = {
								has_war_with = CAS
								has_war_with = NAV
								has_war_with = SEU
								has_war_with = SPC
								has_war_with = ANL
								has_war_with = ARA
								has_war_with = ROOT
							}
						}
					}
					ROOT = {
						annex_country = {
							target = CAT
							transfer_troops = no
						}
					}
				}
				else_if = {
					limit = {
						country_exists = CAT
						CAT = {
							NOT = {
								has_war_with = CAS
								has_war_with = NAV
								has_war_with = SEU
								has_war_with = SPC
								has_war_with = ANL
								has_war_with = ARA
								has_war_with = ROOT
							}
						}
					}
					ROOT = {
						add_ai_strategy = {
							type = antagonize
							id = "CAT"
							value = 500
						}
						add_ai_strategy = {
							type = conquer
							id = "CAT" 
							value = 500
						}
					}
				}
			}
			
			#Определение победителя // Конец ГВ либералов
			if = {
				limit = {
					OR = {
						has_global_flag = liberal_spanish_civil_war
						has_global_flag = haos_liberal_spanish_civil_war
					}
					NOT = { has_global_flag = scw_over }
					ROOT = {
						OR = {
							tag = SPR
							tag = CAS
							tag = NAV
							tag = SEU
							tag = SPC
							tag = ANL
							tag = ARA
							tag = ASU
							tag = SNT
							tag = CAT
							tag = BAS
							tag = GLC
							tag = VLA
						}
					}
					FROM = {
						OR = {
							tag = SPR
							tag = CAS
							tag = NAV
							tag = SEU
							tag = SPC
							tag = ANL
							tag = ARA
							tag = ASU
							tag = SNT
							tag = CAT
							tag = BAS
							tag = GLC
							tag = VLA
						}
					}
				}
				ROOT = { country_event = { id = NWspain.50 hours = 6 } }
			}
			
			#SIK теряет нац.духа после аннексии Уйгуров
			if = {
				limit = {
					FROM = { tag = UYG }
					ROOT = { tag = SIK }
				}
				ROOT = { remove_ideas = SIK_nationalism }
			}
			
			if = {
				limit = {
					FROM = { tag = UYG }
					ROOT = { tag = SIK }
				}
				ROOT = { load_focus_tree = china_warlord_focus }
			}
		}
	}
	
	on_release_as_free = {
		effect = {
			ROOT = { country_event = { id = TRpolitical.106 } }
			if = {
				limit = {
					tag = POL
					POL = { has_cosmetic_tag = POL_SOV }
				}
				POL = { drop_cosmetic_tag = yes }
			}
			if = {
				limit = {
					tag = COG
					FROM = {
						NOT = {
							original_tag = BEL
						}
					}
				}
				COG = {
					drop_cosmetic_tag = yes
				}
			}
			if = {
				limit = {
					tag = SYR
					has_cosmetic_tag = SYR_FRA
					FROM = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LEB
					has_cosmetic_tag = LEB_FR
					FROM = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LKA
					has_cosmetic_tag = LKA_ENG
					FROM = { NOT = { original_tag = ENG } }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = BPL
					has_cosmetic_tag = BPL_UK
					FROM = { NOT = { original_tag = ENG } }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = NFL
					has_cosmetic_tag = NFL_ENG
					FROM = { NOT = { original_tag = ENG } }
				}
				drop_cosmetic_tag = yes
			}
		}
	}
	
	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		effect = {
			FROM = { country_event = { id = TRpolitical.106 } }
			#France
			if = {
				limit = {
					FROM = { tag = FRA }
					ROOT = { tag = FRC }
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
				every_country = {
					limit = {
						has_war_with = ROOT
						NOT = { original_tag = ROOT }
						NOT = { original_tag = FROM }
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				ROOT = {
					remove_ideas = FRA_civil_war
					news_event = { id = trworldnews.80 hours = 6 }
					clear_global_event_target = NW_france_scope
					save_global_event_target_as = NW_france_scope
				}
			}
			if = {
				limit = {
					FROM = { tag = FRC }
					ROOT = { tag = FRA }
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
				ROOT = {
					remove_ideas = FRA_civil_war
					news_event = { id = trworldnews.81 hours = 6 }
					clear_global_event_target = NW_france_scope
					save_global_event_target_as = NW_france_scope
				}
			}
			if = {
				limit = {
					FROM = {
						original_tag = FRC
						NOT = { tag = FRC }
						OR = { tag = D01 tag = D02 tag = D03 tag = D04 tag = D05 tag = D06 tag = D07 tag = D08 tag = D09 tag = D10 tag = D11 tag = D12 tag = D13 tag = D14 tag = D15 tag = D16 tag = D17 tag = D18 tag = D19 tag = D20 tag = D21 tag = D22 tag = D23 tag = D24 tag = D25 tag = D26 tag = D27 tag = D28 tag = D29 tag = D30 tag = D31 tag = D32 tag = D33 tag = D34 tag = D35 tag = D36 tag = D37 tag = D38 tag = D39 tag = D40 tag = D41 tag = D42 tag = D43 tag = D44 tag = D45 tag = D46 tag = D47 tag = D48 tag = D49 tag = D50 }
						#has_government = communism
					}
					ROOT = { OR = { tag = FRA tag = FRC } }
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
				ROOT = {
					annex_country = {
						target = FROM
						transfer_troops = no
					}
				}
			}
			
			#Кагуляры // FRF
			if = {
				limit = {
					FROM = { tag = FRA }
					ROOT = { tag = FRF }
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
				ROOT = {
					remove_ideas = FRA_civil_war
					news_event = { id = trworldnews.88 hours = 6 }
					clear_global_event_target = NW_france_scope
					save_global_event_target_as = NW_france_scope
				}
			}
			if = {
				limit = {
					FROM = { tag = FRF }
					ROOT = { tag = FRA }
				}
				every_state = {
					limit = { is_claimed_by = FROM }
					remove_claim_by = FROM
				}
				every_state = {
					limit = { is_core_of = FROM }
					remove_core_of = FROM
				}
				every_country = {
					limit = {
						has_war_with = ROOT
						NOT = { original_tag = ROOT }
						NOT = { original_tag = FROM }
						is_subject = no
						OR = { is_faction_leader = yes is_in_faction = no }
					}
					white_peace = ROOT
				}
				ROOT = {
					remove_ideas = FRA_civil_war
					news_event = { id = trworldnews.80 hours = 6 }
					clear_global_event_target = NW_france_scope
					save_global_event_target_as = NW_france_scope
				}
			}
			
			
			
			if = {
				limit = {
					FROM = { tag = POL }
					ROOT = { tag = event_target:NW_hhnbrg_scope }
				}
				event_target:NW_hhnbrg_scope = {
					delete_unit_template_and_units = {
						division_template = "Polish volunteers"
					}
				}
			}
			if = {
				limit = {
					FROM = {
						tag = SYR
						has_cosmetic_tag = SYR_FRA
					}
					ROOT = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					FROM = {
						tag = LEB
						has_cosmetic_tag = LEB_FR
					}
					ROOT = {
						NOT = {
							original_tag = FRA
							original_tag = FRC
							original_tag = FRR
							original_tag = FRF
						}
					}
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					FROM = {
						tag = LKA
						has_cosmetic_tag = LKA_ENG
					}
					ROOT = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					FROM = {
						tag = NFL
						has_cosmetic_tag = NFL_ENG
					}
					ROOT = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			#Костыль для советско-финской
			if = {
				limit = {
					FROM = {
						OR = {
							tag = SOV
							tag = FIN
						}
					}
					ROOT = {
						OR = {
							tag = SOV
							tag = FIN
						}
					}
					SOV = { has_country_flag = soviet_finland_war_flag }
				}
				SOV = { clr_country_flag = soviet_finland_war_flag }
				FIN = { set_rule = { can_join_factions = yes } }
			}
			#Дуче жрет ETH
			if = {
				limit = {
					ROOT = {
						tag = ITA
						is_ai = yes
					}
					FROM = { tag = ETH }
				}
				ROOT = {
					annex_country = {
						target = FROM
						transfer_troops = no
					}
				}
			}
			#Жор США
			if = {
				limit = {
					ROOT = { tag = USA }
					FROM = { tag = CSA }
				}
				ROOT = {
					annex_country = {
						target = FROM
						transfer_troops = no
					}
				}
			}
			if = {
				limit = {
					ROOT = { tag = CSA }
					FROM = { tag = USA }
				}
				ROOT = {
					annex_country = {
						target = FROM
						transfer_troops = no
					}
				}
			}
			#ЖОР BPL = PAL/ISR
			if = {
				limit = {
					FROM = {
						OR = {
							original_tag = PAL
							original_tag = ISR
						}
					}
					OR = {
						BPL = { is_subject_of = ROOT }
						ROOT = {
							OR = {
								original_tag = BPL
								is_in_faction_with = BPL
								is_subject_of = BPL
							}
						}
					}
				}
				BPL = {
					annex_country = {
						target = FROM
						transfer_troops = yes
					}
				}
				every_state = {
					limit = { is_core_of = FROM }
					add_core_of = BPL
					remove_core_of = FROM
				}
			}
		}
	} #ROOT is winner #FROM is loser
	
	
	#FROM is country getting invited.
	on_offer_join_faction = {
		effect = {
			if = {
				limit = {
					OR = {
						original_tag = FRA
						original_tag = FRC
					}
					FROM = {
						has_idea = BEL_flemish_walloon_conflict 
					}
				}
				FROM = {
					country_event = { id = NWbelgium.6 days = 1 }
				}
			}
			
		}
	}
	
	#FROM is faction leader on join faction requests. THIS DOES NOT FIRE ON ADD_TO_FACTION EFFECT! USE ON_OFFER_JOIN_FACTION!
	on_join_faction = {
		effect = {
			
		}
	}
	
	
	#ROOT is subject FROM is overlord
	on_subject_autonomy_level_change = {
		effect = {
			if = {
				limit = {
					tag = COG
					has_autonomy_state = autonomy_puppet
					FROM = { original_tag = BEL }
				}
				set_cosmetic_tag = COG_colony
			}
			if = {
				limit = {
					tag = COG
					has_autonomy_state = autonomy_dominion
					FROM = { original_tag = BEL }
				}
				drop_cosmetic_tag = yes
			}
		}
	}
	
	#ROOT is winner #FROM gets annexed - This will also fire on_annex
	on_civil_war_end = {
		effect = {
			#Антибританские протесты в Тегеране
			if = {
				limit = {
					original_tag = PER
					has_government = neutrality
					has_country_flag = PER_NWpersian_3a_flag
					FROM = {
						has_government = fascism
					}
				}
				country_event = { id = NWpersian.27 days = 14 }
			}
			if = {
				limit = {
					original_tag = PER
					country_exists = KHU
					NOT = { has_country_flag = arabistan_flag }
				}
				if = {
					limit = { KHU = { is_in_faction = yes } }
					KHU = { leave_faction = yes }
				}
				country_event = { id = NWpersian.67 days = 1 }
			}
			if = {
				limit = {
					original_tag = PER
				}
				if = {
					limit = {
						country_exists = QAS
						ROOT = { NOT = { has_war_with = QAS } }
						NOT = { has_country_flag = NWpersian_74_flag }
					}
					country_event = { id = NWpersian.74 hours = 6 }
				}
			}
			#Исламисты победили в Иранской гражданской войне
			if = {
				limit = {
					original_tag = PER
					has_government = fascism
				}
				news_event = { id = trworldnews.95 hours = 6 }
			}
			#Реформисты победили в Иранской гражданской войне
			if = {
				limit = {
					original_tag = PER
					NOT = { has_government = fascism }
					FROM = { has_government = fascism }
				}
				news_event = { id = trworldnews.96 hours = 6 }
			}
			#Свержение императора
			if = {
				limit = {
					original_tag = ETH
					has_government = anarchism
				}
				country_event = { id = NWethiopia.101 hours = 6 }
			}
			#Боеспособность армии // Либерия
			if = {
				limit = {
					original_tag = LIB
					has_government = fascism
				}
				country_event = { id = nw_liberia.21 hours = 3 }
			}
		}
		#ROOT is winner #FROM gets annexed - This will also fire on_annex
	}
	
	
	on_daily = {
		effect = {
			#Таймер недели
			if = {
				limit = { NOT = { check_variable = { counter_days = 7 } } }
				add_to_variable = { counter_days = 1 }
			}
			if = {
				limit = { check_variable = { counter_days = 7 } }
				set_variable = { counter_days = 0 }
				if = {
					limit = {
						has_country_flag = timer_timer_flag
						country_exists = ROOT
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): Новая неделя"
				}
				else_if = {
					limit = {
						any_country = {
							has_country_flag = timer_timer_flag
							NOT = { country_exists = THIS }
						}
					}
					every_country = { clr_country_flag = timer_timer_flag }
					random_country = { set_country_flag = timer_timer_flag }
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): Теперь крикун"
				}
				
				#Голод // Нацдух ETH / LIB
				if = {
					limit = {
						OR = {
							has_idea = ETH_hunger
							has_idea = LIB_hunger
						}
					}
					every_owned_state = {
						limit = { is_core_of = ROOT }
						add_manpower = -5000
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): минус 5000 менпавера"
				}
				#ETH_ethiopism_trait_1500 // Еженедельный прирост населения: §R-1500§!
				if = {
					limit = {
						has_idea = ETH_ethiopism
					}
					random_owned_state = {
						add_manpower = -1500
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): минус 1500 менпавера"
				}
				#ETH_ethiopism_trait_1000 // Еженедельный прирост населения: §R-1000§!
				if = {
					limit = {
						OR = {
							has_idea = ETH_ethiopism_2
							has_idea = ETH_american_blacks_3
						}
					}
					random_owned_state = {
						add_manpower = -1000
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): минус 1000 менпавера"
				}
				#ETH_american_blacks_trait_1000 // Еженедельный прирост населения: §G1000§!
				if = {
					limit = {
						OR = {
							has_idea = ETH_ethiopism_3
							has_idea = ETH_american_blacks_2
						}
					}
					random_owned_state = {
						add_manpower = 1000
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): плус 1000 менпавера"
				}
				#ETH_american_blacks_trait_1500 // Еженедельный прирост населения: §G1500§!
				if = {
					limit = {
						has_idea = ETH_american_blacks
					}
					random_owned_state = {
						add_manpower = 1500
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): плус 1500 менпавера"
				}
				#Нац.дух на слонов
				if = {
					limit = {
						OR = {
							has_idea = LIB_elephants
							has_idea = ETH_elephants
							has_idea = ETH_elephants_2
							has_idea = ETH_elephants_3
							has_idea = ETH_elephants_4
							has_idea = ETH_elephants_5
						}
					}
					set_temp_variable = { total_elephant_equipment = ETH_elephants_trait_var }
					set_temp_variable = { num_elephant_states = 0 }
					every_owned_state = {
						limit = { has_state_flag = elephant_spawn_state_flag }
						add_to_temp_variable = { num_elephant_states = 1 }
					}
					multiply_temp_variable = { total_elephant_equipment = num_elephant_states }
					add_equipment_to_stockpile = {
						type = elephant_equipment
						amount = total_elephant_equipment
					}
					log = "[GetDateText]: [This.GetName] ([This.GetTag]): плус [?total_elephant_equipment] слонов"
				}
				#административная эффективность // anarchism
				if = {
					limit = {
						has_variable = administrative_efficiency_var_total
						has_country_flag = generic_attracting_public_attention_to_our_company_flag
					}
					add_to_variable = { administrative_efficiency_var_total = 0.025 }
				}
			}
			#Армянские спецслужбы // Решения PER
			if = {
				limit = { has_idea = PER_armenian_special_services }
				subtract_from_variable = { level_integration_south_azerbaijan = 0.01 }
			}
			#PER_growth_of_suspicion_among_officers
			if = {
				limit = {
					has_idea = PER_growth_of_suspicion_among_officers
				}
				add_to_variable = { PER_army_tension_var = 0.1 }
				clamp_variable = { var = PER_army_tension_var min = 0 max = 100 }
			}
			#PER_dissatisfaction_due_decrease_in_salary
			if = {
				limit = {
					has_idea = PER_dissatisfaction_due_decrease_in_salary
				}
				add_to_variable = { PER_army_tension_var = 0.1 }
				clamp_variable = { var = PER_army_tension_var min = 0 max = 100 }
			}
			#ЧЕК 100% НАПРЯГИ ГЕНЕРАЛИТЕТА PER
			if = {
				limit = {
					tag = PER
					has_variable = PER_army_tension_var
					check_variable = { PER_army_tension_var = 100 }
					NOT = { has_country_flag = PER_army_tension_var_end_flag }
				}
				set_country_flag = PER_army_tension_var_end_flag
				country_event = { id = NWpersian.90 }
			}
			#ФИКСАЦИЯ ВЛИЯНИЯ И ОТНОШЕНИЯ ДУХОВЕНСТВА PER
			if = {
				limit = {
					original_tag = PER
					has_completed_focus = PER_islamic_revolution
					has_government = fascism
				}
				set_variable = { opinion_with_clergy_var = 10 }
				set_variable = { influence_of_clergy_var = 10 }
			}
			#СБРОС ПРИРОСТА НАПРЯГИ
			if = {
				limit = { original_tag = BPL }
				if = {
					limit = { has_variable = BPL_arab_tensions_chance }
					set_variable = { BPL_arab_tensions_chance = 0 }
				}
				if = {
					limit = { has_variable = BPL_jews_tensions_chance }
					set_variable = { BPL_jews_tensions_chance = 0 }
				}
			}
			#BPL_plight_of_arab_peasantry // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_plight_of_arab_peasantry
				}
				add_to_variable = { BPL_arab_tensions_total = 0.04 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.04 }
			}
			#BPL_jewish_state // BPL
			if = {
				limit = {
					has_variable = BPL_jews_tensions_total
					has_idea = BPL_jewish_state
				}
				subtract_from_variable = { BPL_jews_tensions_total = 5 }
				clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
				subtract_from_variable = { BPL_jews_tensions_chance = 5 }
			}
			#BPL_discontent_among_arabs // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_discontent_among_arabs
				}
				add_to_variable = { BPL_arab_tensions_total = 1 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 1 }
			}
			#BPL_outflow_arabs_from_israel // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_outflow_arabs_from_israel
				}
				subtract_from_variable = { BPL_arab_tensions_total = 0.05 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				subtract_from_variable = { BPL_arab_tensions_chance = 0.05 }
			}
			#Roy Godfrey Bullen // BPL
			if = {
				limit = {
					OR = {
						has_variable = BPL_arab_tensions_total
						has_variable = BPL_jews_tensions_total
					}
					has_country_leader = {
						name = "Roy Godfrey Bullen"
						ruling_only = yes
					}
				}
				if = {
					limit = { has_variable = BPL_arab_tensions_total }
					add_to_variable = { BPL_arab_tensions_total = 0.01 }
					clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
					add_to_variable = { BPL_arab_tensions_chance = 0.01 }
				}
				if = {
					limit = { has_variable = BPL_jews_tensions_total }
					subtract_from_variable = { BPL_jews_tensions_total = 0.01 }
					clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
					subtract_from_variable = { BPL_jews_tensions_chance = 0.01 }
				}
			}
			#Harold MacMichael // BPL
			if = {
				limit = {
					OR = {
						has_variable = BPL_arab_tensions_total
						has_variable = BPL_jews_tensions_total
					}
					has_country_leader = {
						name = "Harold MacMichael"
						ruling_only = yes
					}
				}
				if = {
					limit = { has_variable = BPL_arab_tensions_total }
					subtract_from_variable = { BPL_arab_tensions_total = 0.01 }
					clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
					subtract_from_variable = { BPL_arab_tensions_chance = 0.01 }
				}
					
				if = {
					limit = { has_variable = BPL_jews_tensions_total }
					add_to_variable = { BPL_jews_tensions_total = 0.01 }
					clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
					add_to_variable = { BPL_jews_tensions_chance = 0.01 }
				}
			}
			
			#Видный араб
			#BPL_rarib_al_nashashibi // BPL
			if = {
				limit = {
					has_variable = BPL_jews_tensions_total
					has_idea = BPL_rarib_al_nashashibi
				}
				add_to_variable = { BPL_jews_tensions_total = 0.01 }
				clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_jews_tensions_chance = 0.01 }
			}
			#BPL_abd_al_haja_muhammad // BPL
			if = {
				limit = {
					has_variable = BPL_jews_tensions_total
					has_idea = BPL_abd_al_haja_muhammad
				}
				add_to_variable = { BPL_jews_tensions_total = 0.01 }
				clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_jews_tensions_chance = 0.01 }
			}
			#BPL_fevzi_al_kawukji // BPL
			if = {
				limit = {
					has_variable = BPL_jews_tensions_total
					has_idea = BPL_fevzi_al_kawukji
				}
				add_to_variable = { BPL_jews_tensions_total = 0.01 }
				clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_jews_tensions_chance = 0.01 }
			}
			
			#Видный еврей
			#BPL_martin_buber // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_martin_buber
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_david_ben_gurion // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_david_ben_gurion
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_berl_katznelson // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_berl_katznelson
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_uri_zvi_greenberg // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_uri_zvi_greenberg
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_eliezer_berkovich // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_eliezer_berkovich
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_yitzhak_ben_zvi // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_yitzhak_ben_zvi
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#BPL_otto_warburg // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_otto_warburg
				}
				add_to_variable = { BPL_arab_tensions_total = 0.01 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_arab_tensions_chance = 0.01 }
			}
			#Стремление к компромиссу // BPL
			if = {
				limit = {
					OR = {
						has_variable = BPL_arab_tensions_total
						has_variable = BPL_jews_tensions_total
					}
					has_idea = BPL_striving_for_compromise
				}
				if = {
					limit = {
						has_variable = BPL_arab_tensions_total
						check_variable = { BPL_arab_tensions_chance > 0 }
					}
					set_temp_variable = { BPL_arab_tensions_temp = BPL_arab_tensions_chance }
					divide_temp_variable = { BPL_arab_tensions_temp = 2 }
					subtract_from_variable = { BPL_arab_tensions_total = BPL_arab_tensions_temp }
					clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
					divide_variable = { BPL_arab_tensions_chance = 2 }
				}
				if = {
					limit = {
						has_variable = BPL_jews_tensions_total
						check_variable = { BPL_jews_tensions_chance > 0 }
					}
					set_temp_variable = { BPL_jews_tensions_temp = BPL_jews_tensions_chance }
					divide_temp_variable = { BPL_jews_tensions_temp = 2 }
					subtract_from_variable = { BPL_jews_tensions_total = BPL_jews_tensions_temp }
					clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
					divide_variable = { BPL_jews_tensions_chance = 2 }
				}
			}
			#BPL_legalize_arms_supplies_from_europe_idea // BPL
			if = {
				limit = {
					has_idea = BPL_legalize_arms_supplies_from_europe_idea
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = 2
				}
			}
			#BPL_arab_state // BPL
			if = {
				limit = {
					has_variable = BPL_arab_tensions_total
					has_idea = BPL_arab_state
				}
				subtract_from_variable = { BPL_arab_tensions_total = 5 }
				clamp_variable = { var = BPL_arab_tensions_total min = 0 max = 100 }
				subtract_from_variable = { BPL_arab_tensions_chance = 5 }
			}
			#BPL_discontent_among_jews // BPL
			if = {
				limit = {
					has_variable = BPL_jews_tensions_total
					has_idea = BPL_discontent_among_jews
				}
				add_to_variable = { BPL_jews_tensions_total = 1 }
				clamp_variable = { var = BPL_jews_tensions_total min = 0 max = 100 }
				add_to_variable = { BPL_jews_tensions_chance = 1 }
			}
			#TUR_send_kurds_from_region // Ежедневная численность населения в регионе: §R-300§!
			if = {
				limit = {
					any_owned_state = { has_state_flag = TUR_send_kurds_from_region_flag }
				}
				every_owned_state = {
					limit = { has_state_flag = TUR_send_kurds_from_region_flag }
					add_manpower = -300
				}
			}
			#PER_organize_an_uprising_in_tajikistan // PER
			if = {
				limit = {
					has_country_flag = PER_organize_an_uprising_in_tajikistan_flag
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = -10
				}
			}
			#PER_organize_an_uprising_in_azerbaijan // PER
			if = {
				limit = {
					has_country_flag = PER_organize_an_uprising_in_azerbaijan_flag
				}
				add_equipment_to_stockpile = {
					type = infantry_equipment
					amount = -10
				}
			}
			
			
			#ANARCHISM UNITY
			#СБРОС ПРИРОСТА ЕДИНСТВА
			if = {
				limit = {
					has_government = anarchism
					has_variable = anarchism_unity_daily_var
				}
				set_variable = { anarchism_unity_daily_var = 0.1 }
				###
				#BPL_kibbutz_basis_of_trade_unions_idea // BPL
				if = {
					limit = {
						has_idea = BPL_kibbutz_basis_of_trade_unions_idea
					}
					add_to_variable = { anarchism_unity_daily_var = 0.1 }
				}
				#BPL_autonomy_of_workplace // BPL
				if = {
					limit = {
						has_idea = BPL_autonomy_of_workplace
					}
					add_to_variable = { anarchism_unity_daily_var = 0.15 }
				}
				#FRC_creation_of_working_communities // FRC
				if = {
					limit = {
						has_idea = FRC_creation_of_working_communities
					}
					add_to_variable = { anarchism_unity_daily_var = 0.05 }
				}
				#FRC_getting_rid_of_state // FRC
				if = {
					limit = {
						has_idea = FRC_getting_rid_of_state
					}
					add_to_variable = { anarchism_unity_daily_var = 0.05 }
				}
				#FRC_development_of_theories_of_syndicalism // FRC
				if = {
					limit = {
						has_idea = FRC_development_of_theories_of_syndicalism
					}
					add_to_variable = { anarchism_unity_daily_var = 0.1 }
				}
				#FRC_synthetic_organization // FRC
				if = {
					limit = {
						has_idea = FRC_synthetic_organization
					}
					add_to_variable = { anarchism_unity_daily_var = 0.05 }
				}
				#RSI_labour_confederation // RSI
				if = {
					limit = {
						has_idea = RSI_labour_confederation
					}
					add_to_variable = { anarchism_unity_daily_var = 0.1 }
				}
				#continuous_anarchism_unity // anarchism
				if = {
					limit = {
						focus_progress = { focus = continuous_anarchism_unity progress > 0 }
					}
					add_to_variable = { anarchism_unity_daily_var = 0.5 }
				}
				add_to_variable = { anarchism_unity_daily_var = anarchism_unity_daily_var_dec }
				add_to_variable = { anarchism_unity_var = anarchism_unity_daily_var }
				clamp_variable = { var = anarchism_unity_var min = 0 max = 100 }
			}
		}
	}
	
	#ROOT is the nation being liberated, FROM is the leader of the liberators. 
	on_liberate = {
		effect = {
			ROOT = { country_event = { id = TRpolitical.106 } }
			if = {
				limit = {
					tag = SYR
					has_cosmetic_tag = SYR_FRA
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LEB
					has_cosmetic_tag = LEB_FR
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = LKA
					has_cosmetic_tag = LKA_ENG
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = BPL
					has_cosmetic_tag = BPL_UK
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					tag = NFL
					has_cosmetic_tag = NFL_ENG
					FROM = { original_tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
		}
	}
	
	# called when a country send volunteers to another
	# ROOT is sender, FROM is receiver
	on_send_volunteers = {
		effect = {
			#Чек FRF добровольцев в Испании
			if = {
				limit = {
					SPR_scw_in_progress = yes
					ROOT = {
						tag = FRF
						NOT = { has_country_flag = FRF_demand_balearic_islands_flag }
					}
					FROM = {
						OR = {
							tag = SPA
							tag = SPR
						}
					}
				}
				set_country_flag = FRF_demand_balearic_islands_flag
			}
		}
	}
	
	#FROM is the nuked state. 
	on_nuke_drop = {
		#аннигиляция войск
		effect = {
			if = {
				limit = {
					NOT = {
						has_game_rule = {
							rule = nuclear_bomb_kill_army_status
							option = NUCLEAR_BOMB_KILL_ARMY_STATUS_OFF
						}
					}
				}
				every_country = { delete_unit = { state = FROM } }
				if = {
					limit = {
						has_game_rule = {
							rule = nuclear_bomb_kill_army_status
							option = NUCLEAR_BOMB_KILL_ARMY_STATUS_ON_HARD
						}
					}
					FROM = {
						every_neighbor_state = {
							every_country = { delete_unit = { state = PREV } }
						}
					}
				}
			}
		}
	}
	
}

