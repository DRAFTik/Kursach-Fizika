#	THIS FILE IS FOR on_actions SPECIFICALLY FOR THE chinese TAGs

on_actions = { # Общекитайские мехи
	
	# ROOT is new controller, FROM is old controller, FROM.FROM is state ID. 
	on_state_control_changed = { # china_integrate_province
		effect = {
			if = {
				limit = { is_in_array = { global.chinese_state = FROM.FROM } }
				ROOT = { 
					if = {
						limit = { FROM.FROM = { NOT = { is_core_of = PREV } } }
						activate_targeted_decision = { target = FROM.FROM.china_capital_of_province decision = china_integrate_province }
						if = {
							limit = { NOT = { is_in_array = { chinese_integrate_province_state_map = FROM.FROM:china_capital_of_province.id } } }
							for_each_loop = {
								array = FROM.FROM.china_capital_of_province:chinese_province
								value = state
								
								add_to_array = { chinese_integrate_province_state_map = state }
							}
						}
					}
				}
				FROM = {
					if = {
						limit = { 
							all_of = {
								array = FROM.FROM.chinese_province
								value = state
								
								NOT = { controls_state = var:state }
							} 
						}
						remove_targeted_decision = { target = FROM.FROM.china_capital_of_province decision = china_integrate_province }
						if = {
							limit = { is_in_array = { chinese_integrate_province_state_map = FROM.FROM:china_capital_of_province.id } }
							for_each_loop = {
								array = FROM.FROM.china_capital_of_province:chinese_province
								value = state
								
								remove_from_array = { chinese_integrate_province_state_map = state }
							}
						}
					}
				}
				log = "[GetDateText]: [FROM.FROM.GetName] [FROM.FROM.GetID]: check china_integrate_province decision trigger (ROOT: [ROOT.GetTag] FROM: [FROM.GetTag])"
			}
		}
	}
	
	# ROOT is attacker, FROM is defender
	on_war_relation_added = { # attack_against_communists
		effect = {
			if = {
				limit = {
					check_variable = { NW_attack_against_communists > 0 }
					FROM = { has_government = communism }
				}
				set_temp_variable = { enemy = FROM }
				set_attack_against_communists_bonus = yes
			}
			else_if = {
				limit = {
					FROM = { check_variable = { NW_attack_against_communists > 0 } }
					has_government = communism
				}
				FROM = {
					set_temp_variable = { enemy = ROOT }
					set_attack_against_communists_bonus = yes
				}
			}
		}
	}
}

on_actions = { # Китайские страны, с небольшим кол-вом экшонов

	### EHB ###
	
	on_startup = {
		effect = {
			if = {
				limit = {
					has_start_date < 1936.01.02
				}
				EHB = {
					country_event = { id = hebei.4 days = 2 }
					country_event = { id = hebei.5 days = 192 }
				}
			}
		}	
	}
	
	### YCP ##
	
	on_weekly_YCP = {
		effect = {
			if = {
				limit = { has_start_date < 1936.01.02 }
				if = {
					limit = {
						surrender_progress > 0.8 # TODO balance
						has_war_with = MAN
					}
					country_event = ycp.3
				}
				
				if = {
					limit = { has_idea = YCP_communist_logistic_idea }
					add_equipment_to_stockpile = {
						type = infantry_equipment
						amount = 21
					}
				}
			}
		}
	}
	
	on_monthly_YCP = {
		effect = {
			if = {
				limit = { has_start_date < 1936.01.02 }
				if = {
					limit = {
						any_neighbor_country = {
							is_literally_china = yes
							NOT = { is_subject_of = JAP } # not japan bitches (MAN CSR EHB)
							OR = { controls_state = 608 controls_state = 1132 } 
						} 
					}
					country_event = { id = ycp.1 }
					country_event = { id = ycp.2 } # TODO days = 1
				}
			}
		}
	}
	
	on_war_relation_added = { # on_declare_war 
		effect = {
			if = {
				limit = {
					OR = {
						AND = {
							FROM = { original_tag = JAP }
							original_tag = CHI
						}
						AND = {
							original_tag = JAP 
							FROM = { original_tag = CHI }
						}
					}
				}
				CHI = { country_event = { id = ycp.5 days = 50 } }
			}
		}
	}
	
	on_join_faction = { 
		effect = {
			if = {
				limit = {
					OR = {
						AND = {
							FROM = { original_tag = PRC }
							original_tag = CHI
						}
						AND = {
							original_tag = PRC
							FROM = { original_tag = CHI }
						}
					}
				}
				CHI = { country_event = { id = ycp.6 days = 30 } }
			}
		}
	}
	
	on_capitulation = {
		effect = {
			if = {
				limit = {
					tag = MAN
					FROM = { tag = YCP }
					is_subject_of = JAP
					NOT = { country_exists = MGM country_exists = CMA }
				}
				JAP = { country_event = ycp.40 }
			}
		}
	}
	
	on_annex = { # on_civil_war_end
		effect = {
			if = {
				limit = {
					FROM = { original_tag = YCP }
					original_tag = MAN
				}
				FROM = { # TODO возвращать в случае повторного появления YCP?
					every_character = { ## FROM characters return to ROOT ##
						limit = {
							OR = {
								is_character = YCP_zeng_qi 
								is_character = YCP_li_huan 
								is_character = YCP_zuo_shunsheng 
							}
						}
						set_nationality = ROOT
						log = "[GetDateText]: [THIS.GetName]: character set_nationality = [Root.GetTag]"
					}
				}
			}
		}
	}
}