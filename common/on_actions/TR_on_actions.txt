on_actions = {
	on_startup = {
		effect = {
			#Configurator & Wonder Setup Event
			random_country = {
				limit = { is_ai = no }
				set_global_flag = nw_configurator_open
				country_event = { id = TR.wonder.1 }
			}
			
			#Start pointer great china wall
			every_country = {
				set_variable = {
					var = bonus_gw
					value = 0
				}
			}
			
			#Start legitimacy
			every_country = {
				country_event = { id = TRlegitimacy.8 }
			}
			
			random_country = {
				limit = { is_ai = no }
				set_variable = {
					var = global.total_infantry_weapons
					value = 0
				}
				set_variable = {
					var = global.total_support
					value = 0
				}
				set_variable = {
					var = global.total_motorized
					value = 0
				}
				set_variable = {
					var = global.total_mechanized
					value = 0
				}
				set_variable = {
					var = global.total_light_tanks
					value = 0
				}
				set_variable = {
					var = global.total_air_light_fighter
					value = 0
				}
				set_variable = {
					var = global.total_air_heavy_fighter
					value = 0
				}
			}
			#NZL = { country_event = { id = TRpolitical.35 } }
		}
	}
	

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			#check controller of great china wall
			if = {
				limit = {
					FROM.FROM = { 
						has_state_flag = great_wall_wonder_flag
						is_controlled_by = ROOT
					}
				}
				ROOT = {
					add_to_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
				FROM = {
					subtract_from_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
			}
		}
	}
	
	#Фикс аннекса Испании
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			if = {
				limit = {
					ROOT = { tag = SPR }
					FROM = { tag = RSP }
				}
				RSP = {
					annex_country = {
						target = SPR
						transfer_troops = yes
					}
				}
			}
			if = {
				limit = {
					ROOT = { tag = RSP }
					FROM = { tag = SPR }
				}
				SPR = {
					annex_country = {
						target = RSP
						transfer_troops = yes
					}
				}
			}
		}
	}
	
	on_government_change = {
		effect = {
			#Габсы
			if = {
				limit = {
					OR = {
						original_tag = CZE
						original_tag = AUS
						#AND = {
						#	original_tag = HUN	#Венгр и так монархист со старта
						#	HUN = { has_completed_focus = HUN_invite_the_habsburg_prince }
						#}
					}
					has_government = monarchy
				}
				if = {
					limit = { all_country = { NOT = { has_country_flag = hbbrg_flag } } }
					country_event = { id = NWmonarchy.0 }
				}
				if = {
					limit = { any_other_country = { has_country_flag = hbbrg_flag } }
					set_country_flag = hbbrg_minor_flag
					random_country = {
						limit = { has_country_flag = hbbrg_flag }
						if = {
							limit = { has_government = fascism }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_reichsprotectorate
							}
						}
						if = {
							limit = { NOT = { has_government = fascism } }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_puppet
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					tag = TUR
					has_government = fascism
				}
				TUR = { country_event = { id = NWturkey.69 days = 140 } }
			}
			
			if = {
				limit = {
					tag = USA
					has_government = trozkism
				}
				set_autonomy = {
					target = USA
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = { has_war_with = ROOT }
					white_peace = PREV
				}
				if = {
					limit = {
						USA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					USA = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					USA = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					USA = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			if = {
				limit = {
					tag = CAN
					has_government = trozkism
				}
				set_autonomy = {
					target = CAN
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = { has_war_with = ROOT }
					white_peace = PREV
				}
				if = {
					limit = {
						CAN = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					CAN = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					CAN = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					CAN = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			if = {
				limit = {
					tag = BRA
					has_government = trozkism
				}
				set_autonomy = {
					target = BRA
					autonomy_state = autonomy_free
				}
				every_other_country = {
					limit = { has_war_with = ROOT }
					white_peace = PREV
				}
				if = {
					limit = {
						BRA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					BRA = { leave_faction = yes }
				}
				if = {
					limit = { KMX = { is_faction_leader = yes } }
					BRA = {
						add_ai_strategy = {
							type = alliance
							id = "KMX"
							value = 400
						}
					}
					BRA = { KMX = { country_event = { id = generic.2 days = 0 } } }
				}
			}
			
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = trozkism
					NOT = { tag = TUR }
				}
				random_list = {
					50 = { set_country_leader_ideology = marxism1 }
					50 = { set_country_leader_ideology = trozkism1 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					NOT = { has_country_flag = authoritarian_democracy }
					NOT = { has_country_flag = militarism }
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
		}
	}
	
	
	#ROOT is subject FROM is previous overlord
	on_subject_free = {
		effect = {
			if = {
				limit = {
					ROOT = { tag = PAL }
					FROM = { tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					ROOT = { tag = JOR }
					FROM = { tag = ENG }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					ROOT = { tag = LEB }
					FROM = { tag = FRA }
				}
				drop_cosmetic_tag = yes
			}
			if = {
				limit = {
					ROOT = { tag = SYR }
					FROM = { tag = FRA }
				}
				drop_cosmetic_tag = yes
			}
		}
	}
	
	
	#used when puppeting in a peace conference
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = trozkism
					NOT = { tag = TUR }
				}
				random_list = {
					50 = { set_country_leader_ideology = marxism1 }
					50 = { set_country_leader_ideology = trozkism1 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					NOT = { has_country_flag = authoritarian_democracy }
					NOT = { has_country_flag = militarism }
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
		}
	}
	
	
	
	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord
	
	on_release_as_puppet = {
		effect = {
			
			#Смена подидеологии в случае ошибочной генерации
			if = {
				limit = {
					has_government = trozkism
					NOT = { tag = TUR }
				}
				random_list = {
					50 = { set_country_leader_ideology = marxism1 }
					50 = { set_country_leader_ideology = trozkism1 }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					NOT = { has_country_flag = authoritarian_democracy }
					NOT = { has_country_flag = militarism }
					NOT = {
						original_tag = GXC
						original_tag = YUN
						original_tag = SHX
						original_tag = XSM
						original_tag = SIK
						original_tag = SIH
						original_tag = XIK
						original_tag = SHA
					}
				}
				random_list = {
					25 = { set_country_leader_ideology = despotism }
					25 = { set_country_leader_ideology = oligarchism }
					25 = { set_country_leader_ideology = moderatism }
					25 = { set_country_leader_ideology = centrism }
				}
			}
			if = {
				limit = {
					has_government = neutrality
					has_country_flag = authoritarian_democracy
				}
				set_country_leader_ideology = authoritarian_democracy
			}
			if = {
				limit = {
					has_government = neutrality
					OR = {
						has_country_flag = militarism
						OR = {
							original_tag = GXC
							original_tag = YUN
							original_tag = SHX
							original_tag = XSM
							original_tag = SIK
							original_tag = SIH
							original_tag = XIK
							original_tag = SHA
						}
					}
				}
				set_country_leader_ideology = militarism
			}
		}
	}
	
	
	
}

