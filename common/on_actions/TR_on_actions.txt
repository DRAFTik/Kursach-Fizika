on_actions = {
	on_startup = {
		effect = {
			#Wonder Setup Event
			random_country = {
				limit = { is_ai = no }
				country_event = { id = TR.wonder.1 }
			}
			
			#Start pointer great china wall
			every_country = {
				set_variable = {
					var = bonus_gw
					value = 0
				}
			}
			
			#Start legitimacy
			every_country = {
				country_event = { id = TRlegitimacy.8 }
			}
			
			random_country = {
				limit = { is_ai = no }
				set_variable = {
					var = global.total_infantry_weapons
					value = 0
				}
				set_variable = {
					var = global.total_support
					value = 0
				}
				set_variable = {
					var = global.total_motorized
					value = 0
				}
				set_variable = {
					var = global.total_mechanized
					value = 0
				}
				set_variable = {
					var = global.total_light_tanks
					value = 0
				}
				set_variable = {
					var = global.total_air_light_fighter
					value = 0
				}
				set_variable = {
					var = global.total_air_heavy_fighter
					value = 0
				}
			}
			#NZL = { country_event = { id = TRpolitical.35 } }
		}
	}
	

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			#check controller of great china wall
			if = {
				limit = {
					FROM.FROM = { 
						has_state_flag = great_wall_wonder_flag
						is_controlled_by = ROOT
					}
				}
				ROOT = {
					add_to_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
				FROM = {
					subtract_from_variable = { var = bonus_gw value = 1 }
					country_event = { id = TR.wonder.28 }
				}
			}
		}
	}
	
	#Фикс аннекса Испании
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			if = {
				limit = {
					ROOT = { tag = SPR }
					FROM = { tag = RSP }
				}
				RSP = {
					annex_country = {
						target = SPR
						transfer_troops = yes
					}
				}
			}
			if = {
				limit = {
					ROOT = { tag = RSP }
					FROM = { tag = SPR }
				}
				SPR = {
					annex_country = {
						target = RSP
						transfer_troops = yes
					}
				}
			}
		}
	}
	
	#Габсы
	on_government_change = {
		effect = {
			if = {
				limit = {
					OR = {
						original_tag = CZE
						original_tag = AUS
						#AND = {
						#	original_tag = HUN	#Венгр и так монархист со старта
						#	HUN = { has_completed_focus = HUN_invite_the_habsburg_prince }
						#}
					}
					has_government = monarchy
				}
				if = {
					limit = { all_country = { NOT = { has_country_flag = hbbrg_flag } } }
					country_event = { id = NWmonarchy.0 }
				}
				if = {
					limit = { any_other_country = { has_country_flag = hbbrg_flag } }
					set_country_flag = hbbrg_minor_flag
					random_country = {
						limit = { has_country_flag = hbbrg_flag }
						if = {
							limit = { has_government = fascism }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_reichsprotectorate
							}
						}
						if = {
							limit = { NOT = { has_government = fascism } }
							set_autonomy = {
								target = ROOT
								autonomy_state = autonomy_puppet
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					tag = TUR
					has_government = fascism
				}
				TUR = { country_event = { id = NWturkey.69 days = 140 } }
			}
			
			if = {
				limit = {
					tag = USA
					has_government = trozkism
				}
				if = {
					limit = {
						USA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					USA = { leave_faction = yes }
					if = {
						limit = { KMX = { is_faction_leader = yes } }
						KMX = { add_to_faction = USA }
					}
				}
				if = {
					limit = { USA = { has_war_with = KMX } }
					KMX = { white_peace = USA }
				}
			}
			if = {
				limit = {
					tag = CAN
					has_government = trozkism
				}
				if = {
					limit = {
						CAN = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					CAN = { leave_faction = yes }
					if = {
						limit = { KMX = { is_faction_leader = yes } }
						KMX = { add_to_faction = CAN }
					}
				}
				if = {
					limit = { CAN = { has_war_with = KMX } }
					KMX = { white_peace = CAN }
				}
			}
			if = {
				limit = {
					tag = BRA
					has_government = trozkism
				}
				if = {
					limit = {
						BRA = {
							is_in_faction = yes
							NOT = { is_in_faction_with = KMX }
						}
					}
					BRA = { leave_faction = yes }
					if = {
						limit = { KMX = { is_faction_leader = yes } }
						KMX = { add_to_faction = BRA }
					}
				}
				if = {
					limit = { BRA = { has_war_with = KMX } }
					KMX = { white_peace = BRA }
				}
			}
		}
	}
	
}

