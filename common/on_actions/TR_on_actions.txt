on_actions = {
	on_startup = {
		effect = {
			#Wonder Setup Event
			random_country = {
				limit = { is_ai = no }
				country_event = TR.wonder.1
			}
			
			#Start pointer great china wall
			every_country = {
				set_variable = {
					var = bonus_gw
					value = 0
				}
			}
			
			#Start legitimacy
			every_country = {
				country_event = TRlegitimacy.8
			}
			
			random_country = {
				limit = { is_ai = no }
				set_variable = {
					var = global.total_infantry_weapons
					value = 0
				}
				set_variable = {
					var = global.total_support
					value = 0
				}
				set_variable = {
					var = global.total_motorized
					value = 0
				}
				set_variable = {
					var = global.total_mechanized
					value = 0
				}
				set_variable = {
					var = global.total_light_tanks
					value = 0
				}
				set_variable = {
					var = global.total_air_light_fighter
					value = 0
				}
				set_variable = {
					var = global.total_air_heavy_fighter
					value = 0
				}
			}
			
			#NZL = { country_event = TRpolitical.35 }
		}
	}
	

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			#check controller of great china wall
			if = {
				limit = {
					FROM.FROM = { 
						has_state_flag = great_wall_wonder_flag
						is_controlled_by = ROOT
					}
				}
				ROOT = {
					add_to_variable = { var = bonus_gw value = 1 }
					country_event = TR.wonder.28
				}
				FROM = {
					subtract_from_variable = { var = bonus_gw value = 1 }
					country_event = TR.wonder.28
				}
			}
		}
	}
	
	#Фикс аннекса Испании
	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			if = {
				limit = {
					ROOT = { tag = SPR }
					FROM = { tag = RSP }
				}
				RSP = {
					annex_country = {
						target = SPR
						transfer_troops = yes
					}
				}
			}
			if = {
				limit = {
					ROOT = { tag = RSP }
					FROM = { tag = SPR }
				}
				SPR = {
					annex_country = {
						target = RSP
						transfer_troops = yes
					}
				}
			}
		}
	}
	
	
	on_government_change = {
		effect = {
			if = {
				limit = {
					has_government = trozkism
					NOT = { has_country_flag = gov_trozkist }
				}
				every_country = {
					limit = { has_government = communism }
					add_opinion_modifier = { target = ROOT modifier = op_trozkist }
				}
				add_opinion_modifier = { target = PREV modifier = op_trozkist1 }
				set_country_flag = gov_trozkist
				
				every_country = {
					limit = {
						has_government = trozkism
					}
					remove_opinion_modifier = { target = ROOT modifier = op_trozkist1 }
				}
				remove_opinion_modifier = { target = PREV modifier = op_trozkist }
			}
			
			if = {
				limit = {
					NOT = { has_government = trozkism }
					has_country_flag = gov_trozkist
				}
				every_country = {
					limit = { has_government = communism }
					remove_opinion_modifier = { target = ROOT modifier = op_trozkist }
				}
				remove_opinion_modifier = { target = PREV modifier = op_trozkist1 }
				clr_country_flag = gov_trozkist
			}
			
			if = {
				limit = { has_government = communism }
				every_country = {
					limit = { has_government = trozkism }
					add_opinion_modifier = { target = ROOT modifier = op_trozkist1 }
				}
				add_opinion_modifier = { target = PREV modifier = op_trozkist }
			}
		}
	}
}

