on_actions = {
	
	on_startup = {
	
		effect = { 
			if = {
				limit = { 
					has_dlc = "By Blood Alone" 
				}
				
				SWI = { 
					SWI_update_neighbor_opinion_balance = yes
					SWI_find_biggest_fascist_neighbor = yes
					SWI_find_best_democratic_ally = yes
					SWI_find_democratic_planes_seller = yes 
				} 
			}
		} 
		effect = {
			# League of Nations Members
			IF = {
				limit = {
					date < 1939.1.1 # don't bother with LoN after 1939
				}
				every_country = {
					limit = {
						OR = {
							### Original Members
							tag = ARG 
							tag = BEL
							tag = BOL
							tag = ENG
							tag = AST
							tag = CAN
							tag = RAJ
							tag = NZL
							tag = SAF
							tag = CHI
							tag = COL
							tag = CUB
							tag = CZE
							tag = DEN
							tag = FRA
							tag = GRE
							tag = HAI
							tag = ITA
							tag = LIB
							tag = HOL
							tag = NOR
							tag = PAN
							tag = PER
							tag = PRU
							tag = POL
							tag = POR
							tag = ROM
							tag = SIA
							tag = SPR
							tag = SWE
							tag = SWI
							tag = URU
							tag = VEN
							tag = YUG
							### 1920
							tag = AUS
							tag = BUL
							tag = COS
							tag = FIN
							tag = LUX
							tag = ALB
							### 1921
							tag = EST
							tag = LAT
							tag = LIT
							### 1922
							tag = HUN
							### 1923
							tag = IRE
							tag = ETH
							### 1924
							tag = DOM
							### 1931
							tag = MEX
							### 1932
							tag = TUR
							tag = IRQ 
							### 1934
							tag = SOV
							tag = AFG
							tag = ECU 
						}
					}
					add_ideas = league_of_nations_member_idea
				}
				
			}
		}
	}

	on_monthly = {
		# re-unification event for same tag
		effect = {
			IF = {
				limit = {
					NOT = { has_global_flag = global_unification_request_sent_flag } # one per month should be enough
					is_subject = no
					has_war = no
					NOT = { has_country_flag = yes_to_unification_flag }
					NOT = { has_country_flag = no_to_unification_flag }
					NOT = { has_country_flag = unification_request_sent_flag }
					any_country_with_original_tag = {
						original_tag_to_check = ROOT
						NOT = { tag = ROOT }
						exists = yes 
						is_subject = no
						has_government = ROOT
						has_war = no
						NOT = { has_country_flag = yes_to_unification_flag }
						NOT = { has_country_flag = no_to_unification_flag }
						NOT = { has_country_flag = unification_request_sent_flag }
					}
					 
				}

				# LOG = "dispatcher event for [ROOT.GetName] triggered" #TODO_TA Remove logging
				set_global_flag = global_unification_request_sent_flag
				every_country = {
					
					limit = {
						original_tag = ROOT 
						is_subject = no
						has_government = ROOT
						has_war = no
						NOT = { has_country_flag = yes_to_unification_flag }
						NOT = { has_country_flag = no_to_unification_flag }
						NOT = { has_country_flag = unification_request_sent_flag }
					}
					set_country_flag = unification_request_sent_flag
					country_event = {
						id = political.31
						hours = 10
						random_hours = 8
					}
				}
			}
			if = {
				limit = {
					SWI_bba = yes
				}
				SWI = { 

					SWI_find_democratic_planes_seller = yes 
					SWI_find_biggest_fascist_neighbor = yes
					SWI_update_neighbor_opinion_balance = yes
				} 
			}

		}
	}


	on_peace = {
		effect = {
			if = { #For when Switzerland wants to go back to the Good Old Times 
				limit = {
					SWI_bba = yes
					has_idea = SWI_old_switzerland_idea
				}			
				add_ideas = {
					SWI_swiss_neutrality
					SWI_citizen_militia_1
				}
				remove_ideas = { SWI_old_switzerland_idea }
				retire_character = SWI_henri_guisan 
			}
		

		}
		effect = {
			if = {
				limit = {
					SWI_bba = yes 
				}
				SWI_make_helvetia_peace = yes 
			}
		}
	}
	#ROOT = country that joined a war
	on_war = {
		effect = {
			if = {
				limit = {
					original_tag = SWI 
					has_country_flag = SWI_in_secret_pact_with_allies
				}
				var:SWI.SWI_secret_ally = {
					if = {
						limit = { is_faction_leader = yes }
						add_to_faction = SWI
					}
					else_if = {
						limit = {
							is_in_faction = yes
						}
						random_other_country = {
							limit = {
								is_in_faction_with = PREV
								is_faction_leader = yes
							}
							add_to_faction = SWI
						}
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					SWI_bba = yes
					SWI_has_any_spirit_of_helvetia = yes
				}
				SWI_make_helvetia_war = yes 
			}
		}
	}
	#ROOT = attacking side
	#FROM = defending side
	
	#fired when two countries end up at war with each other (on_war is fired when a country goes to war against anyone and is not fired again when it enters war against another country unless it went to peace first)
	on_declare_war = { 
   	# Disable LoN if more members go to war with each other 
		effect = {
			IF = {
				limit = {
					NOT = { has_global_flag = LoN_disbanded_flag }
					FROM = {
						# is_major = yes 
						has_idea = league_of_nations_member_idea
					}
					ROOT = {
						is_major = yes 
						has_idea = league_of_nations_member_idea
					}
				}
				set_global_flag = LoN_disbanded_flag
				set_variable = { global.LoN_attacker_country = ROOT }
				set_variable = { global.LoN_defender_country = FROM }
				news_event = { id = bba_news.0 hours = 4 random_hours = 8}
			}
		}
	}
	# ROOT is capitulated country, FROM is winner
	on_capitulation = {
		effect = {
			if = {
				limit = {
					tag = SOV
					FROM = {
						tag = ITA
						has_country_flag = ITA_pope_took_over_italy_flag
						ITA_is_ruled_by_a_pope = yes
					}
				}
				FROM = {
					set_country_flag = ITA_stalin_how_many_guns_achievement
				}
			}
		}
	}
	#ROOT is subject FROM is previous overlord
	on_subject_free = {
		effect = {
			IF = {
				limit = {
					original_tag = AOI
				}
				AOI = {
					drop_cosmetic_tag = yes
				}
			}
		}
	}
	
	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		# Drop AOI cosmetic tag to set correct flag
		effect = {
			IF = {
				limit = {
					original_tag = AOI
					NOT = {
						is_subject_of = ITA
					}
				}
				AOI = {
					drop_cosmetic_tag = yes
				}
			}
		}
		effect = {
			if = {
				limit = {
					tag = SWI
					has_country_flag = swi_declared_war_on_GER_achievement_flag
					FROM = {
						original_tag = GER
					}
				}
				set_country_flag = swi_won_war_on_GER_achievement_flag
			}
		}
		effect = {
			if = {
				limit = {
					tag = SWI
					#TODO also needs to check for defensive war status
					NOT = {
						has_country_flag = swi_lost_state_achievement
					}
				}
				set_country_flag = swi_you_shall_not_pass_achievement
			}
		}

		effect = {
			SWI = {
				set_variable = { cheese_states = 0 } 
				every_owned_state = {
					limit = {
						NOT = {
							any_neighbor_state = {
								is_owned_by = SWI
							}
						}
					}
					SWI = { add_to_variable = { cheese_states = 1 } }
				}
			}
		}

		effect = { #Achievement This Time it will Stick
			if = {
				limit = {
					has_government = democratic
					is_in_faction_with = ENG
					ENG = { has_government = democratic }
					has_global_flag = rhineland_remilitarized #so it was remilitarized once
					42 = {
						pc_does_state_stack_demilitarized = yes
					}
					51 = {
						pc_does_state_stack_demilitarized = yes
					}
				}
				set_global_flag = disarmed_and_demilitarized_rhineland_flag
			}
		}
	}
	
	#FROM is war target
  	#ROOT is country declaring war
	on_declare_war = {
		effect = {
			IF = {
				limit = {
					ROOT = {
						NOT = { has_dynamic_modifier = {modifier = african_union_defense_agreement_modifier} }
					}
					FROM = { has_dynamic_modifier =  {modifier = african_union_defense_agreement_modifier }}
				}
				set_variable = {
					var = global.org_africa_attacked_country
					value = FROM
				}
				every_other_country = {
					limit = {
						has_dynamic_modifier = {
							modifier = african_union_defense_agreement_modifier
						}
						NOT = { has_war_with = FROM }
						NOT = { tag = FROM }
					}
					country_event = {
						id = BBA_african_union_events.18
						hours = 1
					}
				}
			}
		}

		effect = {
			#Italy defends Austria from Germany
			if = {
				limit = {
					ROOT = { 
						original_tag = GER 
					}
					FROM = { 
						original_tag = AUS 
					}
					ITA = {
						has_completed_focus = ITA_guarantee_austrian_independence
					}
				}

				AUS = {
					give_military_access = ITA
				}
				
				ITA = {
					add_timed_idea = {
						idea = ITA_alpine_defense
						days = 360
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					tag = SWI
					FROM = {
						original_tag = GER
					}
				}
				set_country_flag = swi_declared_war_on_GER_achievement_flag
			}
		}
	}

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		# Losing cores and colonies as Italy has an impact on BoP
		effect = {
			if = {
				limit = { #Losing a core State
					FROM = { original_tag = SWI }
					FROM.FROM = { is_core_of = SWI }
				}
				FROM.FROM = {
					if = {
						limit = { #Destroys infra and railways on lost states
					 		has_dynamic_modifier = { modifier = SWI_infrastructure_rigged_to_blow }
						}
						damage_building = {
							type = rail_way
							damage = 5
						}
						damage_building = {
							type = infrastructure
							damage = 5
						}
						damage_building = {
							type = arms_factory 
							damage = 2
						}
						damage_building = {
							type = industrial_complex
							damage = 2
						}
						damage_building = {
							type = bunker
							damage = 10
						}
						damage_building = {
							type = supply_node
							damage = 1
						}
						remove_dynamic_modifier = { modifier = SWI_infrastructure_rigged_to_blow }
					}
				}
			}
		}


		#RENAME STATES/VPs
		effect = {
			if = {
				limit = {
					ITA_state_or_vp_name_should_change = yes
				}
				ITA_change_name_of_state_or_vp = yes
			}
		}
		effect = {
			if = {
				limit = { #SWI loses a state
					FROM = {
						original_tag = SWI
						NOT = {
							has_country_flag = swi_lost_state_achievement
						}
					}
					FROM.FROM = {
						OR = {
							state = 847 #W Alps
							state = 151 #E Alps
 							state = 846 #Tincio
						}
					}
				}
				FROM = {
					set_country_flag = swi_lost_state_achievement
				}
			}
		}
		effect = {
			if = {
				limit = {
					FROM = { tag = ITA }
					tag = BRA
					FROM.FROM = { state = 2 }
					divisions_in_state = {
						unit = paratrooper
						size > 1
						state = 2
					}
				}
				set_country_flag = BRA_snakes_on_a_plane_achievement
			}
		}
		
	}
	#used when puppeting in a peace conference
  	#ROOT = nation being puppeted, FROM = overlord
	#used when puppeting through the occupied territories menu during peace time (or when releasing from non-core but owned territory, f.e. Britain releasing Egypt)
	#ROOT = nation being released, FROM = overlord

	on_release_as_puppet = {
		effect = {
			SWI_on_action_puppet_selection = yes #If it's SWI, it will check which Cosmetic Tag will apply
		}
	}
	
	on_puppet = { #ROOT = nation being puppeted, FROM = overlord
		effect = {
			SWI_on_action_puppet_selection = yes #If it's SWI, it will check which Cosmetic Tag will apply
		}

		# In case of historical split of N and S Korea try to locate the correct leaders
		effect = {
			IF = {
				limit = {
					original_tag = KOR
					has_government = democratic
					NOT = { 
						has_country_leader = {
							name = "Syngman Rhee"
							ruling_only = no
						}
					}
				}
				
				random_other_country = {
					limit = {
						original_tag = KOR
						has_country_leader = {
							name = "Syngman Rhee"
							ruling_only = no
						}
						NOT = { has_government = democratic }
					}
					every_character = {
						limit = {
							has_ideology_group = democratic
						}
						set_nationality =  ROOT
					}	
				}
				retire_country_leader = yes
				
			}
			IF = {
				limit = {
					original_tag = KOR
					has_government = communism
					NOT = { 
						has_country_leader = {
							name = "Kim Il-sung"
							ruling_only = no
						}
					}
				}
				
				random_other_country = {
					limit = {
						original_tag = KOR
						has_country_leader = {
							name = "Kim Il-sung"
							ruling_only = no
						}
						NOT = { has_government = communism }
					}
					every_character = {
						limit = {
							has_ideology_group = communism
						}
						set_nationality =  ROOT
					}	
				}
				retire_country_leader = yes
				
			}
		}
	}


	#FROM is country getting invited. ROOT is the faction leader
	on_offer_join_faction = {
		effect = {
			if = {
				limit = {
					OR = {
						AND = {
							tag = ITA
							FROM = { tag = GER has_government = fascism }
						}
						AND = {
							tag = GER
							has_government = fascism
							FROM = { tag = ITA }
						}
					}
				}
				ITA = { set_country_flag = ITA_joined_faction_with_literally_hitler_achievement_flag }
			}
		}
	}
}



