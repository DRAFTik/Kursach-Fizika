NW_migration_check = {
	
	if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_1_flag }
			OR = {
				AND = {
					has_stability < 0.099
					OR = {
						has_idea = balanced_migration_policy
						has_idea = promoting_immigration
					}
				}
				AND = {
					has_stability < 0.149
					has_idea = ease_border_control
				}
				AND = {
					has_stability < 0.049
					has_idea = strengthen_border_controls
				}
			}
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.8		# 0-10 #
			
			set_variable = { num_new_level_mig_var = 1 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление, добавить тоже самое в _NW_legitimacy_scripted_effects
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 1 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 1 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_2_flag }
			OR = {
				#AND = { ?
				#	has_stability > 0.1
				#	has_stability < 0.149
				#	has_idea = promoting_immigration
				#}
				AND = {
					has_stability > 0.05
					has_stability < 0.149
					has_idea = promoting_immigration
				}
				AND = {
					has_stability > 0.15
					has_stability < 0.249
					has_idea = ease_border_control
				}
				AND = {
					has_stability > 0.1
					has_stability < 0.199
					has_idea = balanced_migration_policy
				}
			}
			#NOT = { has_idea = severe_migration_control } ?
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.7		# high_level_of_emigration (10-20) #
			
			set_variable = { num_new_level_mig_var = 2 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 2 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 2 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_3_flag }
			OR = {
				AND = {
					has_stability > 0.15
					has_stability < 0.299
					OR = {
						has_idea = promoting_immigration
						has_idea = strengthen_border_controls
					}
				}
				AND = {
					has_stability > 0.25
					has_stability < 0.399
					has_idea = ease_border_control
				}
				AND = {
					has_stability > 0.20
					has_stability < 0.349
					has_idea = balanced_migration_policy
				}
			}
			#NOT = { has_idea = severe_migration_control } ?
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.6		# average_level_of_emigration (20-35) #
			
			set_variable = { num_new_level_mig_var = 3 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 3 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 3 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_4_flag }
			OR = {
				AND = {
					has_stability > 0.30
					has_stability < 0.399
					has_idea = promoting_immigration
				}
				AND = {
					has_stability > 0.40
					has_stability < 0.449
					has_idea = ease_border_control
				}
				AND = {
					has_stability > 0.35
					has_stability < 0.449
					has_idea = balanced_migration_policy
				}
				AND = {
					has_stability > 0.30
					has_stability < 0.449
					has_idea = strengthen_border_controls
				}
				AND = {
					has_stability < 0.449
					has_idea = severe_migration_control
				}
			}
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.5		# # low_level_of_emigration (35-45) #
			
			set_variable = { num_new_level_mig_var = 4 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 4 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 4 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_5_flag }
			OR = {
				AND = {
					has_stability > 0.40
					has_stability < 0.549
					has_idea = promoting_immigration
				}
				AND = {
					has_stability > 0.45
					has_stability < 0.599
					OR = {
						has_idea = balanced_migration_policy
						has_idea = ease_border_control
						has_idea = strengthen_border_controls
						has_idea = severe_migration_control
					}
				}
				has_idea = closed_border
			}
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.4		# normal_level_of_migration (45-60) #
			
			set_variable = { num_new_level_mig_var = 5 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 5 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 5 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_6_flag }
			OR = {
				AND = {
					has_stability > 0.55
					has_stability < 0.699
					has_idea = promoting_immigration
				}
				AND = {
					has_stability > 0.60
					has_stability < 0.699
					has_idea = ease_border_control
				}
				AND = {
					has_stability > 0.60
					has_stability < 0.749
					has_idea = balanced_migration_policy
				}
				AND = {
					has_stability > 0.60
					has_stability < 0.799
					has_idea = strengthen_border_controls
				}
				AND = {
					has_stability > 0.60
					has_idea = severe_migration_control
				}
			}
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.3		# low_migration_growth (60-75) #
			
			set_variable = { num_new_level_mig_var = 6 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 6 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 6 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			if = { limit = { has_government = anarchism } has_idea = promoting_immigration }
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_7_flag }
			OR = {
				AND = {
					surrender_progress < 0.01
					num_of_civilian_factories > 2
					amount_research_slots > 2
					capital_scope = {
						NOT = {
							has_state_category = rural
							has_state_category = pastoral
							has_state_category = small_island
							has_state_category = tiny_island
							has_state_category = wasteland
						}
					}
					OR = {
						AND = {
							has_stability > 0.70
							has_stability < 0.799
							OR = {
								has_idea = promoting_immigration
								has_idea = ease_border_control
							}
						}
						AND = {
							has_stability > 0.75
							has_stability < 0.849
							has_idea = balanced_migration_policy
						}
						AND = {
							has_stability > 0.80
							has_stability < 0.899
							has_idea = strengthen_border_controls
						}
					}
				}
				AND = {
					OR = {
						surrender_progress > 0.01
						num_of_civilian_factories < 3
						amount_research_slots < 3
						capital_scope = {
							OR = {
								has_state_category = rural
								has_state_category = pastoral
								has_state_category = small_island
								has_state_category = tiny_island
								has_state_category = wasteland
							}
						}
					}
					OR = {
						AND = {
							has_stability > 0.70
							OR = {
								has_idea = promoting_immigration
								has_idea = ease_border_control
							}
						}
						AND = {
							has_stability > 0.75
							has_idea = balanced_migration_policy
						}
						AND = {
							has_stability > 0.80
							has_idea = strengthen_border_controls
						}
					}
				}
			}
			#NOT = { has_idea = severe_migration_control } ?
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.2		# average_migration_growth (75-85) #
			
			set_variable = { num_new_level_mig_var = 7 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 7 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 7 }
			NW_startup_set_level_migration = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_government = anarchism }
			NOT = { has_country_flag = migration_block_flag }
			NOT = { has_country_flag = level_of_migration_8_flag }
			surrender_progress < 0.01
			num_of_civilian_factories > 2
			amount_research_slots > 3
			capital_scope = {
				NOT = {
					has_state_category = rural
					has_state_category = pastoral
					has_state_category = small_island
					has_state_category = tiny_island
					has_state_category = wasteland
				}
			}
			OR = {
				AND = {
					has_stability > 0.80
					OR = {
						has_idea = promoting_immigration
						has_idea = ease_border_control
					}
				}
				AND = {
					has_stability > 0.85
					has_idea = balanced_migration_policy
				}
				AND = {
					has_stability > 0.90
					has_idea = strengthen_border_controls
				}
			}
			#NOT = { has_idea = severe_migration_control } ?
			#NOT = { has_idea = closed_border } ?
		}
		if = {
			limit = { date > 1936.1.2 }	
#			country_event = tmo.migration.1		# high_migration_growth (85-100) #
			
			set_variable = { num_new_level_mig_var = 8 }
			NW_set_level_migration = yes
			clr_country_flag = change_legitimacy_flag #заново создаем уведомление
			set_country_flag = { flag = change_migration_level_flag days = 4 value = 8 } #alert
		}
		else = {
			set_variable = { num_new_level_mig_var = 8 }
			NW_startup_set_level_migration = yes
		}
	}
}

###

NW_set_level_migration = {
	meta_effect = {
		text = {
			swap_ideas = {
				remove_idea = level_of_migration_[NUM_CURRENT_LEV_MIG]
				add_idea = level_of_migration_[NUM_NEW_LEV_MIG]
			}
			clr_country_flag = level_of_migration_[NUM_CURRENT_LEV_MIG]_flag
			set_country_flag = level_of_migration_[NUM_NEW_LEV_MIG]_flag
		}
		NUM_NEW_LEV_MIG = num_new_level_mig_var
		NUM_CURRENT_LEV_MIG = num_current_level_mig_var
	}
	set_variable = { num_current_level_mig_var = num_new_level_mig_var }
}
NW_startup_set_level_migration = {
	meta_effect = {
		text = {
			add_ideas = level_of_migration_[NUM_NEW_LEV_MIG]
			set_country_flag = level_of_migration_[NUM_NEW_LEV_MIG]_flag
		}
		NUM_NEW_LEV_MIG = num_new_level_mig_var
	}
	set_variable = { num_current_level_mig_var = num_new_level_mig_var }
}